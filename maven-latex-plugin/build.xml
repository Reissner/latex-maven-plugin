<project name="Main" default="pdf" basedir=".">
  <property name="targetSiteDir"   value="${basedir}/target/site" />
  <property name="targetDir"       value="${basedir}/target" />



  <target 
      name="init" 
      description="Initializes all properties. ">
    <property name="clsDir"           value="target/classes" />
    <property name="tstClsDir"        value="target/test-classes/"/>
    <!--property name="targetDir"        value="target" /-->
    <property name="srcJavaDir"       value="src/main/java/" />
    <property name="compileClsPath"   value="${clsDir}:${tstClsDir}" />
    <property name="encoding"         value="ISO-8859-1"/>
    <property name="javac"
	      value="/usr/lib64/jvm/javaLatest/bin/javac" />
    <property name="antJarDir"
	      value="/usr/share/ant/lib/" />
    <property name="createdJar"
	      value="latex-maven-plugin-1.3-SNAPSHOT-antTask.jar" />

    <!-- ensure that all required directories are present. 
	 these are removed by mvn only. -->
    <mkdir dir="${targetDir}"/>
    <mkdir dir="${clsDir}"/>
  </target>


  <target name="clean" 
	  depends="init"
	  description="Delete all generated files 
		       including tests and site. ">
    <delete includeemptydirs="true" failonerror="false">
      <fileset dir="${targetDir}">
      </fileset>
    </delete>
    <delete file="${antJarDir}${createdJar}" />
  </target>

  <target name="install" 
	  depends="init"
	  description="Creates a jar-file defining the ant-task 
		       and copies it where ant finds it. ">
     <javac srcdir="${srcJavaDir}"
            classpath="${antJarDir}ant.jar"
            destdir="${clsDir}"
            encoding="${encoding}"
            debug="${javac.debug}"
	    debuglevel="none"
            executable="${javac}"
	    excludes="org/m2latex/mojo/**"
            includeAntRuntime="false"
	    compiler="modern"
            fork="yes">
     </javac>
     <jar
	 destfile="${targetDir}/${createdJar}" 
	 basedir="${clsDir}"
	 includes="**/*.class" excludes="${createdJar}"> 
     </jar>
     <copy file="${targetDir}/${createdJar}" 
	   todir="${antJarDir}"/>
  </target>



  <path id="latex.classpath">
    <fileset dir="${basedir}/target"> 
      <include name="latex-maven-plugin-1.3-SNAPSHOT-antTask.jar"/>
    </fileset>
  </path>

  <taskdef name="latex"
	   classname="org.m2latex.antTask.LatexTask"
	   classpathref="latex.classpath"/>

  <target name="latex:cfg"
	  description="Create html and pdf and other formats and other formats 
		       from latex. ">
    <latex>
      <settings texSrcDirectory="src/site/tex"
		tempDirectory="m2latex"
		outputDirectory="."
		targets="pdf, html"
		fig2devCommand="fig2dev"
		texCommand="pdflatex"
		texCommandArgs="-interaction=nonstopmode -src-specials"
		patternErrLatex="! |Fatal error|LaTeX Error|Emergency stop|LaTeX exited abnormally"
		debugBadBoxes='true'
		debugWarnings='true'
		bibtexCommand="bibtex"
		makeIndexCommand="makeindex"
		tex4htCommand="htlatex"
		tex4htStyOptions="html,uni-html4,2,svg"
		tex4htOptions=" -cunihtf -utf8"
		t4htOptions="-cvalidate"
		maxNumReruns='-1'
		latex2rtfCommand="latex2rtf"
		odt2docCommand="odt2doc"
		odt2docOptions="-fdocx"
		pdf2txtCommand="pdftotext"
		pdf2txtOptions=""
		cleanUp='true'>
	<patternErrMakeindex>
	  Extra |
	  Illegal null field| 
	  Argument |
	  Illegal null field|
	  Unmatched |
	  Inconsistent page encapsulator |
	  Conflicting entries
	</patternErrMakeindex>
	<patternNeedLatexReRun>
	  (Rerun (LaTeX|to get cross-references right)|
	  There were undefined references|
	  \(rerunfilecheck\)                Rerun to get outlines right|
	  Package longtable Warning: Table widths have changed. Rerun LaTeX.|
	  Package natbib Warning: Citation\(s\) may have changed)
	</patternNeedLatexReRun>
      </settings>
    </latex>
  </target>
</project>
