<project name="Main" default="pdf" basedir=".">
  <property name="targetSiteDir"   value="${basedir}/target/site" />
  <property name="targetDir"       value="${basedir}/target" />



  <target 
      name="init" 
      description="Initializes all properties. ">
    <property name="clsDir"           value="target/classes" />
    <property name="tstClsDir"        value="target/test-classes/"/>
    <!--property name="targetDir"        value="target" /-->
    <property name="srcJavaDir"       value="src/main/java/" />
    <property name="compileClsPath"   value="${clsDir}:${tstClsDir}" />
    <property name="encoding"         value="ISO-8859-1"/>
    <property name="javac"
	      value="/usr/lib64/jvm/javaLatest/bin/javac" />
    <property name="antJarDir"
	      value="/usr/share/ant/lib/" />
    <property name="createdJar"
	      value="latex-maven-plugin-1.3-SNAPSHOT-antTask.jar" />

    <!-- ensure that all required directories are present. 
	 these are removed by mvn only. -->
    <!--mkdir dir="${targetDir}"/-->
    <mkdir dir="${clsDir}"/>
  </target>


  <target name="clean" 
	  depends="init"
	  description="Delete all generated files 
		       including tests and site. ">
    <delete includeemptydirs="true" failonerror="false">
      <fileset dir="${targetDir}/**">
      </fileset>
    </delete>
    <delete file="${antJarDir}${createdJar}" />
  </target>

  <target name="jar" 
	  depends="init"
	  description="Creates a jar-file defining the ant-task 
		       and copies it where ant finds it. ">
     <javac srcdir="${srcJavaDir}"
            classpath="${antJarDir}ant.jar"
            destdir="${clsDir}"
            encoding="${encoding}"
            debug="${javac.debug}"
	    debuglevel="none"
            executable="${javac}"
	    excludes="org/m2latex/mojo/**"
            includeAntRuntime="false"
	    compiler="modern"
            fork="yes">
     </javac>
     <jar
	 destfile="${targetDir}/${createdJar}" 
	 basedir="${clsDir}"
	 includes="**/*.class" excludes="${createdJar}"> 
     </jar>
  </target>

  <target name="install" 
	  depends="jar"
	  description="Copies the relevant jar-file defining the ant-task 
		       to where ant finds it. ">
     <copy file="${targetDir}/${createdJar}" 
	   todir="${antJarDir}"/>
  </target>



  <path id="latex.classpath">
    <fileset dir="${basedir}/target"> 
      <include name="latex-maven-plugin-1.3-SNAPSHOT-antTask.jar"/>
    </fileset>
  </path>

  <taskdef name="latex"
	   classname="org.m2latex.antTask.LatexTask"
	   classpathref="latex.classpath"/>

  <target name="latex:cfg"
	  description="Create html and pdf and other formats and other formats 
		       from latex. ">
    <latex>
      <settings texSrcDirectory="src/site/tex"
		tempDirectory="m2latex"
		outputDirectory="."
		targets="pdf, html"
		fig2devCommand="fig2dev"
		texCommand="pdflatex"
		texCommandArgs="-interaction=nonstopmode -src-specials -recorder --shell-escape"
		debugBadBoxes='true'
		debugWarnings='true'
		bibtexCommand="bibtex"
		makeIndexCommand="makeindex"
		makeIndexOptions="-c"
		tex4htCommand="htlatex"
		tex4htStyOptions="xhtml,uni-html4,2,svg,pic-tabular"
		tex4htOptions=" -cunihtf -utf8"
		t4htOptions="-cvalidate"
		latex2rtfCommand="latex2rtf"
		odt2docCommand="odt2doc"
		odt2docOptions="-fdocx"
		pdf2txtCommand="pdftotext"
		pdf2txtOptions=""
		maxNumReruns='-1'
		cleanUp='true'>
	<patternLatexMainFile>
	  \s*\\(documentstyle|documentclass).*
	</patternLatexMainFile>
	<patternErrLatex>(^! )</patternErrLatex>
	<patternWarnLatex>
	(^LaTeX Warning: |
	^LaTeX Font Warning: |
	^(Package|Class) .+ Warning: |
	^Missing character: There is no .* in font .*!$|
	^pdfTeX warning (ext4): destination with the same identifier|
	^* Font .+ does not contain script |
	^A space is missing. (No warning).)
	</patternWarnLatex>
	<patternErrBibtex>error message</patternErrBibtex>
	<patternWarnBibtex>Warning--</patternWarnBibtex>
	<patternErrMakeindex>!! Input index error </patternErrMakeindex>
	<patternWarnMakeindex>## Warning </patternWarnMakeindex>
	<patternLatexNeedsReRun>
(^LaTeX Warning: Label\(s\) may have changed. Rerun to get cross-references right.$|
^Package \w+ Warning: .*Rerun .*$|
^Package \w+ Warning: .*$^\(\w+\) .*Rerun .*$|
^LaTeX Warning: Etaremune labels have changed.$|
^\(rerunfilecheck\)                Rerun to get outlines right$)
	</patternLatexNeedsReRun>
      </settings>
    </latex>
  </target>
</project>
