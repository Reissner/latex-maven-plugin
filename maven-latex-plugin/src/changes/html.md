<!-- markdownlint-disable no-trailing-spaces -->
<!-- markdownlint-disable no-inline-html -->

# Creating HTML and related formats from LaTeX 

The following are HTML and related formats: 

- html, xhtml, 
- xml from latexml (and others)
- epub
- office doct xdoc

multipubguide.pdf

Following techniques shall be [evaluated](https://texfaq.org/FAQ-LaTeX2HTML): 

- [tex4ht](#package-tex4ht) 
- latexml
- pandoc 
- lwarp
- latex2html
- research on further possibilities 

Interesting also: how to use `latexmk` in this context. 
To be read: 
<!-- LTeX: language=de-DE -->
texnische Komödie 2015/4 [Mit LaTeX zum E-Book](../site/doc/komoedie_2015_4.pdf)
<!-- LTeX: language=en-US -->

## Package `tex4ht` 

with make4ht and tex4ebook (read the docs)
  In particular have a look at 
  - [make4ht](../site/doc/htlatex/make4ht-doc.pdf) 
    (faster than `htlatex`, more config, support for `destlabel`)
  - [tex4ebook](../site/doc/htlatex/tex4ebook-doc.pdf) 

According to [make4ht](../site/doc/htlatex/make4ht-doc.pdf), Section 3, 
`make4ht` is faster than `htlatex` because it minimizes rerunning latex. 
Further advantages are integration with auxiliary programs like `makeindex`. 
Missing still is `bib2gls`. 

Integration within this software is quite easy with option `--build-file` 


According to `make4ht`, Section 4, the output formats are 
• xhtml
• html5
• odt
• tei
• docbook

They are accessible via the `--format` option can be also used for extension loading. 
Nothing about `epub`. 






### Labels in HTML and related 

For package `tex4ht`, by default, sections, tables and that like are endowed with anchors 
and can thus be referenced in the form `example.html#anchorName`. 
The problem is, that the `anchorName` is generated by the tool chain 
and is thus unintuitive and, even worse, may change in the next run, 
e.g. because a section is inserted. 

For PDF files, anchors are supported via the package `hyperref` 
used with option `destlabel`. 
The result is, that `\label{anchorName}` really creates a 'destination' 
(PDF equivalent to anchor) in the created PDF file 
and can thus be referenced via `example.pdf#anchorName`. 

It seems very desirable that also the package `tex4ht` 
using `hyperref` with option `destlabel` 
and of course option `tex4ht` allows just to use `example.htm#anchorName` 
for `\label{anchorName}` analogously as `example.pdf#anchorName` is used for PDF files. 

At time of this writing, this was not possible. 
Thus, the author filed a [bug report](https://puszcza.gnu.org.ua/bugs/?607). 
The maintainer offered kinds of workarounds based on defining a [preamble](#preamble) 
or using an alternative in [markdown style](#markdown-style). 
The maintainer can be contacted by [email](mailto:michal.h21@gmail.com>). 

A third solution is based on [filters](#filters). 

#### Preamble 

This technique is described in the answer of a [bug report](https://puszcza.gnu.org.ua/bugs/?607). 

Save the following as a file `config.cfg` e.g. in the local directory. 

```[tex]
%%%%%%%%%%%%%%%%%%%
\Preamble{xhtml}
\let\origlabel\label
\def\label#1{%
\HCode{<span id="#1">}%
\origlabel{#1}%
\HCode{</span>}%
}
\begin{document}
\EndPreamble
%%%%%%%%%%%%%%%%%%%
```

Then with `htlatex` execute 

```
htlatex               filename.tex "config,uni-html4,2,svg,pic-tabular" " -cunihtf -utf8"
```

and with `make4ht` execute 

```
make4ht -c config.cfg filename.tex         "uni-html4,2,svg,pic-tabular"
```

That the `tex4htOptions` are empty is because `make4ht` used UTF-8 by default. 

This seems to work only approximately: the anchor seems to be a bit late 
and so cut off the headline. 

#### Markdown Style 

If transforming with `make4ht`, 

```
\section{Exporting in various formats}
```

produces something like this:

```
<h3 class='sectionHead' id='exporting-in-various-formats'><span class='titlemark'>1 </span> <a id='x1-10001'></a>Exporting in various formats</h3>
```

I tried, this works very well. 
Also, it seems to be used internally. 


#### Filters

This was found at [stackoverflow](https://tex.stackexchange.com/questions/260932/destlabel-option-of-the-hyperref-package-does-not-work-in-combination-with-htlat) 
and the solution is also by [michal hoftich](mailto:michal.h21@gmail.com>). 

Store `sample.mk4` file either in the local directory or in any enclosing one 
down to home. 

```[lua]
local filter = require "make4ht-filter"

-- add command for parsing the aux file for labels and corresponding id
-- aux file contains records similar to:
-- \newlabel{first_section}{{\rEfLiNK{x1-40000.1}
local labels = {} 

Make:add("parseaux", function(params)
  local auxname = params.input .. ".aux"
  for line in io.lines(auxname) do
    line:gsub("newlabel%{([^%}]+)%}%{%{.rEfLiNK%{([^%}]+)", function(label,link)
      -- insert links to table so we can search for labels
      labels[link] = label
    end )
  end
end)

if mode=="draft" then
  Make:htlatex()
else
  Make:htlatex()
  Make:htlatex()
  Make:htlatex()
end

Make:parseaux {}

local function replace_labels(html)
  -- match element start
  html = html:gsub("<([a-z0-9A-Z]+)(%s+[^%>]-)>", function(element, attr)
    -- process attributes
    local attr = attr:gsub('([a-z]+)%s*=%s*"([^%"]-)"', function(k,v)
       -- process only id or href attributes
       if k=="id" or k == "href" then
         -- support for links with filenames, we are interested only in the part after '#'
         v = v:gsub("([^%#]+)$", function(link)
           local x = labels[link] or link
           return x
         end)
       end
      return string.format('%s="%s"',k,v)
    end)
    return string.format('<%s %s>', element,  attr)
  end)
  return html
end
local process = filter{replace_labels}

Make:match("html$", process)
```


Compile your file with:

```
make4ht -e sample.mk4 filename "3"
```

yields 

```
<h3 class="sectionHead"><span class="titlemark">0.1</span>
 <a id="first_section"></a>First section</h3>

<!--l. 8-->
<p class="noindent" >Reference to the 
<a href="#first_section">section&#x00A0;0.1</a></p>

<hr class="figure"/>
<div class="figure"><a id="invisible_figure"></a><br/> 
  <div class="caption">
    <span class="id">Figure&#x00A0;1: </span>
    <span class="content">My invisible figure</span>
  </div><!--tex4ht:label?: x5-40011 -->
</div>
<hr class="endfigure"/>
  
<!--l. 15-->
<p class="indent">Reference to the 
<a href="#invisible_figure">Figure&#x00A0;1</a></p>

<div class="table"><!--l. 18-->
  <p class="indent"><a id="invisible_table"></a></p>
  <hr class="float"/>
  <div class="float">
    <div  class="caption">
      <span  class="id">Table&#x00A0;1:</span>
      <span class="content">My invisible table</span>
    </div><!--tex4ht:label?: x5-40021 -->
  </div><hr  class="endfloat"/>
</div>

<!--l. 22-->
<p class="indent">Reference to the <a href="#invisible_table">Table&#x00A0;1</a> </p>
```

it works also for inter-file links:

```
<div class="tableofcontents">
  <span  class="lotToc" >1&#x00A0;
    <a href="samplese1.html#invisible_table">My invisible table</a>
    </span><br/>
</div>
<div class="sectionTOCS">&#x00A0;
  <span  class="sectionToc" >0.1
    <a href="samplese1.html#first_section">First section</a>
  </span>
</div>
```


preamble of `htlatex`: 

```
\makeatletter
\def\HCode{\futurelet\HCode\HChar}
\def\HChar{\ifx"\HCode\def\HCode"##1"{\Link##1}\expandafter\HCode\else\expandafter\Link\fi}
\def\Link#1.a.b.c.{%
\g@addto@macro\@documentclasshook{\RequirePackage[#1,html]{tex4ht}}
\let\HCode\documentstyle
\def\documentstyle{\let\documentstyle\HCode\expandafter\def\csname tex4ht\endcsname{#1,html}
\def\HCode####1{\documentstyle[tex4ht,}\@ifnextchar[{\HCode}{\documentstyle[tex4ht]}}}
\makeatother
\HCode '$2'.a.b.c.\input 
```