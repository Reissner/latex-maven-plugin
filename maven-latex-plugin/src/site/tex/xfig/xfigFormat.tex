
\documentclass[10pt, a4paper]{article}
%\usepackage{latex-bnf}
\begin{document}

\tableofcontents

\section{Introduction}

This file describes the grammar of the native file format of the xfig graphic
program version 3.2. 
It is a copy of xfig.3.2/Doc/FORMAT3.2 in xfig 3.2 source distribution. 



Splines are always X-splines 
X-splines which allows the user to mix interpolation and approximation
points in a same curve. More precisely, it means that an X-spline curve
is neither an interpolated spline nor an approximated one, it is BOTH
(the behaviour of each point is controlled by one single parameter
called "shape factor"). For additional information about X-splines, see:

  "X-Splines: A Spline Model Designed for the End User"
  by C. Blanc and C. Schlick, Proceedings of SIGGRAPH'95

Caveat: Because spline models of previous versions (quadratic B-splines
and Bezier with hidden points) are no longer supported, curves that are
present in version 3.1 and older files are automatically converted to
X-splines. This translation is only an approximation process. It means
that the converted curves are not exactly the same as the original ones.
Though the translation usually provides almost identical curves, some
hand-fitting may be needed in some pathological cases.

Lines starting with \# are comment lines and are ignored. 

Documentation

data Fig
Source

Fig	 
figHeader :: Header
figColors :: [Commented Color]
figObjects :: [Commented Object]


\section{Header}

The very first line is comment line containing the name and version:
        \#FIG 3.2


(2) The first non-comment line consists of the following:

\begin{tabular}{|lll|}
\hline
type & name & Possible values or explanation \\
\hline
\hline
string & orientation             & "Landscape" or "Portrait" \\
string & justification           & "Center" or "Flush Left" \\
string & units                   & "Metric" or "Inches" \\
string & papersize               & "Letter", "Legal", "Ledger", "Tabloid",\\
&&                                  "A", "B", "C", "D", "E",\\
&&                                  "A4", "A3", "A2", "A1", "A0", "B5" \\
float  & magnification           & export and print magnification, \% \\
string & multiple-page           & "Single" or "Multiple" pages \\
int    & transparent color       & color number for transparent color \\
&&                                 for GIF export. \\
&&                                -2=None, -1=background, \\
&&                                0-31 for standard colors or \\
&&                                32- for user colors \\
int    & resolution coord-system & Fig units/inch and coordinate system:\\
&&                                 1: origin at lower left corner \\
&&                                    (NOT USED)\\
&&                                 2: upper left \\
\hline
\end{tabular}



 Fig `resolution' is the resolution of the figure in the file.
    Xfig will always write the file with a resolution of 1200ppi so it
    will scale the figure upon reading it in if its resolution is different
    from 1200ppi.  Pixels are assumed to be square.

    Xfig will read the orientation string and change the canvas to match
    either the Landscape or Portrait mode of the figure file.

    The units specification is self-explanatory.

    The coordinate-system variable is ignored - the origin is ALWAYS the
    upper-left corner.

    ** Coordinates are given in "fig\_resolution" units.
    ** Line thicknesses are given in 80-ths of an inch ("display units").
    ** dash-lengths/dot-gaps are given in 80-ths of an inch.


%\begin{grammar} 
%\end{grammar}
https://hackage.haskell.org/package/fig-1.4.0/docs/Graphics-Fig-Syntax.html



Header:
Orientation
Justification
Units
PaperSize
Magnification
MultiplePage
Transparent
[Comment]
Resolution
CoordinateSystem

Orientation:('Landscape'|'Portrait')

Justification:('Center'|'FlushLeft')

Units:('Metric'|'Inches')

PaperSize:
('Letter'|'Legal'|'Ledger'|'Tabloid'|
'A'|'B'|'C'|'D'|'E'|
'A4'|'A3'|'A2'|'A1'|'A0'|
'B5')

Magnification: Double
resolution: Integer
MultiplePage: ('Single'|'Multiple')


Transparent:
Background	 
None	 
TransparentDefault	 
Transparent ColorSpec	 


CoordinateSystem:
LowerLeft	 
UpperLeft	 
(both are integers)

Commented:
Comment [String] a	 


Color:
color\_number :: Integer
color\_rgb\_values :: String

\section{Objects}


The rest of the file contains various objects.  
An object can be one of six classes (or types).
%
\begin{enumerate}
\item[0]
Color pseudo-object (see Section~\ref{subsec:colorPseudoObj}). 
\item
Ellipse (see Section~\ref{subsec:ellipse}) which is a generalization of circle.
\item
Polyline (see Section~\ref{subsec:polyline}) which includes polygon and box.
\item
Spline (see Section~\ref{subsec:spline}) 
which includes closed/open approximated/interpolated/x-spline spline.
\item
Text (see Section~\ref{subsec:text}).
\item
Arc (see Section~\ref{subsec:arc}).
\item
Compound object (see Section~\ref{subsec:compound}) 
which is composed of one or more objects. 
\end{enumerate}

In the following elaboration on object formats, 
every value of fig output are separated by blank characters 
or new line (`\textbackslash n').  
The value of the unused parameters will be -1.

 Some fields are described as "enumeration type" or "bit vector"; the
 values which these fields can take are defined in the header file object.h.
 The pen\_style field is unused.
 These values may be defined in some future version of Fig.


The two color fields (pen and fill; pen only, for texts) are defined as follows:
%
\begin{enumerate}
\item
            -1 = Default
             0 = Black
             1 = Blue
             2 = Green
             3 = Cyan
             4 = Red
             5 = Magenta
             6 = Yellow
             7 = White
          8-11 = four shades of blue (dark to lighter)
         12-14 = three shades of green (dark to lighter)
         15-17 = three shades of cyan (dark to lighter)
         18-20 = three shades of red (dark to lighter)
         21-23 = three shades of magenta (dark to lighter)
         24-26 = three shades of brown (dark to lighter)
         27-30 = four shades of pink (dark to lighter)
            31 = Gold
\end{enumerate}

values from 32 to 543 (512 total) are user colors and
are defined in color pseudo-objects (type 0)


Object

\setcounter{subsection}{-1}
\subsection{Color Pseudo-Object}\label{subsec:colorPseudoObj}

Color Pseudo-objects (user-defined colors)
          This is used to define arbitrary colors beyond the 32 standard colors.
          The color objects must be defined before any other Fig objects.


    First line:

\begin{tabular}{|lll|}
\hline
type & name & Possible values or explanation \\
\hline
\hline
int        & object-code    & always 0\\
int        & color-number   & color number, from 32-543 (512 total)\\
hex-string & rgb values     & red, green and blue values (e.g. \#330099) \\
\hline
\end{tabular}


\subsection{Ellipse}\label{subsec:ellipse}


\begin{tabular}{|lll|}
\hline
type & name & Possible values or explanation \\
\hline
\hline
int   &  object-code             & always 1 \\
int   &  sub-type                & 1: ellipse defined by radiuses \\
&&                                 2: ellipse defined by diameters \\
&&                                 3: circle defined by radius \\
&&                                 4: circle defined by diameter \\
int   &  line-style              & enumeration type \\
int   &  thickness               & 1/80 inch \\
int   &  pen-color               & enumeration type, pen color \\
int   &  fill-color              & enumeration type, fill color \\
int   &  depth                   & enumeration type \\
int   &  pen-style               & pen style, not used \\
int   &  area-fill               & enumeration type, -1 = no fill \\
float &  style-val               & 1/80 inch \\
int   &  direction               & always 1 \\
float &  angle                   & radians, the angle of the x-axis \\
int   &  center-x, center-y      & Fig units \\
int   &  radius-x, radius-y      & Fig units \\
int   &  start-x, start-y        & Fig units; the 1st point entered \\
int   &  end-x, end-y            & Fig units; the last point entered \\
\hline
\end{tabular}


Ellipse	 

ellipse\_common :: Common
ellipse\_direction :: Integer
ellipse\_angle :: Double
ellipse\_center\_x :: Integer
ellipse\_center\_y :: Integer
ellipse\_radius\_x :: Integer
ellipse\_radius\_y :: Integer
ellipse\_start\_x :: Integer
ellipse\_start\_y :: Integer
ellipse\_end\_x :: Integer
ellipse\_end\_y :: Integer

\subsection{Polyline}\label{subsec:polyline}

    First line:

\begin{tabular}{|lll|}
\hline
type & name & Possible values or explanation \\
\hline
\hline
int    & object-code    & always 2 \\
int    & sub-type       & 1: polyline \\
&&                       2: box \\
&&                       3: polygon \\
&&                       4: arc-box \\
&&                       5: imported-picture bounding-box \\
int    & line-style     & enumeration type \\
int    & thickness      & 1/80 inch \\
int    & pen-color      & enumeration type, pen color \\
int    & fill-color     & enumeration type, fill color \\
int    & depth          & enumeration type \\
int    & pen-style      & pen style, not used \\
int    & area-fill      & enumeration type, -1 = no fill \\
float  & style-val      & 1/80 inch \\
int    & join-style     & enumeration type \\
int    & cap-style      & enumeration type, only used for POLYLINE \\
int    & radius         & 1/80 inch, radius of arc-boxes \\
int    & forward-arrow  & 0: off, 1: on \\
int    & backward-arrow & 0: off, 1: on \\
int    & npoints        & number of points in line \\
\hline
\end{tabular}

    Forward arrow line: same as ARC object

    Backward arrow line: same as ARC object

    Points line:

\begin{tabular}{|lll|}
\hline
type & name & Possible values or explanation \\
\hline
\hline
int & x1, y1            & Fig units \\
int & x2, y2            & Fig units \\
  . &  .    &  .    \\
  . &  .    &  .    \\
int & xnpoints ynpoints & this will be the same \\
    &                   & as the 1st point for polygon and box \\
\hline
\end{tabular}

    PIC line:

\begin{tabular}{|lll|}
\hline
type & name & Possible values or explanation \\
\hline
\hline
boolean & flipped & orientation = normal (0) or flipped (1)\\
char    & file[]  & name of picture file to import\\
\hline
\end{tabular}

\subsection{Spline}\label{subsec:spline}

First line:

\begin{tabular}{|lll|}
\hline
type & name & Possible values or explanation \\
\hline
\hline
int   & object-code    & always 3 \\
int   & sub-type       & 0: opened approximated spline \\
&&                       1: closed approximated spline \\
&&                       2: opened interpolated spline \\
&&                       3: closed interpolated spline \\
&&                       4: opened x-spline \\
&&                       5: closed x-spline \\
int   & line-style     & See the end of this section \\
int   & thickness      & 1/80 inch \\
int   & pen-color      & enumeration type, pen color \\
int   & fill-color     & enumeration type, fill color \\
int   & depth          & enumeration type \\
int   & pen-style      & pen style, not used \\
int   & area-fill      & enumeration type, -1 = no fill \\
float & style-val      & 1/80 inch \\
int   & cap-style      & enumeration type, only used for open splines \\
int   & forward-arrow  & 0: off, 1: on \\
int   & backward-arrow & 0: off, 1: on \\
int   & npoints        & number of control points in spline \\
\hline
\end{tabular}

    Forward arrow line: same as ARC object

    Backward arrow line: same as ARC object

    Points line: same as POLYLINE object

    Control points line :

    There is one shape factor for each point. The value of this factor
    must be between -1 (which means that the spline is interpolated at
    this point) and 1 (which means that the spline is approximated at
    this point). The spline is always smooth in the neighbourhood of a
    control point, except when the value of     the factor is 0 for which
    there is a first-order discontinuity (i.e. angular point).


\subsection{Text}\label{subsec:text}

\begin{tabular}{|lll|}
\hline
type & name & Possible values or explanation \\
\hline
\hline
int     & object     & always 4 \\
int     & sub-type   & 0: Left justified
                                             1: Center justified
                                             2: Right justified \\
int     & color      & enumeration type \\
int     & depth      & enumeration type \\
int     & pen-style  & enumeration , not used \\
int     & font       & enumeration type \\
float   & font-size  & font size in points \\
float   & angle      & radians, the angle of the text \\
int     & font-flags & bit vector \\
float   & height     & Fig units \\
float   & length     & Fig units \\
int     & x, y       & Fig units, coordinate of the origin of the string.  \\
&&                     If sub-type = 0, 
                       it is the lower left corner of the string.\\
&&                     If sub-type = 1, 
                       it is the lower center.  \\
&&                     Otherwise it is the lower right corner of the string. \\
char    & string[]   & ASCII characters; 
                       starts after a blank character \\
&&                     following the last number and
                       ends before the sequence '\textbackslash 001'.  \\
&&                     This sequence is not part of the string.\\
&&                     Characters above octal 177 are
                       represented by \textbackslash xxx\\
&&                     where xxx is the octal value.  \\
&&                     This permits fig files to
                       be edited with 7-bit editors \\
&&                     and sent by e-mail without data loss.\\
&&                     Note that the string may contain '\textbackslash n'. \\
\hline
\end{tabular}

The bits of the font-flags field are defined as follows:

\begin{enumerate}
\item[0]
Rigid text (text doesn't scale when scaling compound objects)
\item
Special text (for \LaTeX)
\item
PostScript font (otherwise \LaTeX{} font is used)
\item
Hidden text
\end{enumerate}

The font field is defined as follows:

For font-flags bit 2 = 0 (\LaTeX{} fonts):

\begin{enumerate}
\item[0] Default font
\item    Roman
\item    Bold
\item    Italic
\item    Sans Serif
\item    Typewriter
\end{enumerate}

For font-flags bit 2 = 1 (PostScript fonts):

\begin{enumerate}
\item[-1] Default font
\item[0]  Times Roman
\item     Times Italic
\item     Times Bold
\item     Times Bold Italic
\item     AvantGarde Book
\item     AvantGarde Book Oblique
\item     AvantGarde Demi
\item     AvantGarde Demi Oblique
\item     Bookman Light
\item     Bookman Light Italic
\item     Bookman Demi
\item     Bookman Demi Italic
\item     Courier
\item     Courier Oblique
\item     Courier Bold
\item     Courier Bold Oblique
\item     Helvetica
\item     Helvetica Oblique
\item     Helvetica Bold
\item     Helvetica Bold Oblique
\item     Helvetica Narrow
\item     Helvetica Narrow Oblique
\item     Helvetica Narrow Bold
\item     Helvetica Narrow Bold Oblique
\item     New Century Schoolbook Roman
\item     New Century Schoolbook Italic
\item     New Century Schoolbook Bold
\item     New Century Schoolbook Bold Italic
\item     Palatino Roman
\item     Palatino Italic
\item     Palatino Bold
\item     Palatino Bold Italic
\item     Symbol
\item     Zapf Chancery Medium Italic
\item     Zapf Dingbats
\end{enumerate}
      



Text	 
text\_sub\_type :: Integer
text\_color :: ColorSpec
text\_depth :: Integer
text\_pen\_style :: Integer
text\_font :: Font
text\_font\_size :: Double
text\_angle :: Double
text\_font\_flags :: FontFlags
text\_height :: Double
text\_length :: Double
text\_x :: Integer
text\_y :: Integer
text\_string :: String

ColorSpec: see Section \ref{sec:param}
Font:
Latex LatexFont	 
Ps PsFont	 


LatexFont:
LatexDefault	 
Roman	 
Bold	 
Italic	 
SansSerif	 
Typewriter	 


PsFont:
PsDefault	 
TimesRoman	 
TimesItalic	 
TimesBold	 
TimesBoldItalic	 
AvantGardeBook	 
AvantGardeBookOblique	 
AvantGardeDemi	 
AvantGardeDemiOblique	 
BookmanLight	 
BookmanLightItalic	 
BookmanDemi	 
BookmanDemiItalic	 
Courier	 
CourierOblique	 
CourierBold	 
CourierBoldOblique	 
Helvetica	 
HelveticaOblique	 
HelveticaBold	 
HelveticaBoldOblique	 
HelveticaNarrow	 
HelveticaNarrowOblique	 
HelveticaNarrowBold	 
HelveticaNarrowBoldOblique	 
NewCenturySchoolbookRoman	 
NewCenturySchoolbookItalic	 
NewCenturySchoolbookBold	 
NewCenturySchoolbookBoldItalic	 
PalatinoRoman	 
PalatinoItalic	 
PalatinoBold	 
PalatinoBoldItalic	 
Symbol	 
ZapfChanceryMediumItalic	 
ZapfDingbats	 


FontFlags:
hidden :: Bool
special :: Bool
rigid :: Bool





\subsection{Arc}\label{subsec:arc}

First line:

\begin{tabular}{|lll|}
\hline
type & name & Possible values or explanation \\
\hline
\hline
int    & object-code            & always 5 \\
int    & sub-type               & 0: pie-wedge (closed) \\
&&                                1: open ended arc \\
int    & line-style             & enumeration type \\
int    & line-thickness         & 1/80 inch \\
int    & pen-color              & enumeration type, pen color \\
int    & fill-color             & enumeration type, fill color \\
int    & depth                  & enumeration type \\
int    & pen-style              & pen style, not used \\
int    & area-fill              & enumeration type, -1 = no fill \\
float  & style-val              & 1/80 inch \\
int    & cap-style              & enumeration type \\
int    & direction              & 0: clockwise, 1: counterclockwise \\
int    & forward-arrow          & 0: no forward arrow, 1: on \\
int    & backward-arrow         & 0: no forward arrow, 1: on \\
float  & center-x, center-y     & center of the arc \\
int    & x1, y1                 & Fig units, the 1st point the user entered \\
int    & x2, y2                 & Fig units, the 2nd point) \\
int    & x3, y3                 & Fig units, the last point \\
\hline
\end{tabular}

    Forward arrow line (Optional; absent if forward-arrow is 0):

\begin{tabular}{|lll|}
\hline
type & name & Possible values or explanation \\
\hline
\hline
int    & arrow-type              & enumeration type \\
int    & arrow-style             & enumeration type \\
float  & arrow-thickness         & 1/80 inch \\
float  & arrow-width             & Fig units \\
float  & arrow-height            & Fig units \\
\hline
\end{tabular}

    Backward arrow line (Optional; absent if backward-arrow is 0):

\begin{tabular}{|lll|}
\hline
type & name & Possible values or explanation \\
\hline
\hline
int    & arrow-type              & enumeration type \\
int    & arrow-style             & enumeration type \\
float  & arrow-thickness         & 1/80 inch \\
float  & arrow-width             & Fig units \\
float  & arrow-height            & Fig units \\
\hline
\end{tabular}


Arc ArcLine (Maybe Arrow) (Maybe Arrow)	 
Spline SplineLine (Maybe Arrow) (Maybe Arrow) [(Integer, Integer)] [Double]

ArcLine:
arc\_common :: Common
arc\_cap\_style :: CapStyle
arc\_direction :: Integer
arc\_center\_x :: Double
arc\_center\_y :: Double
arc\_x1 :: Integer
arc\_y1 :: Integer
arc\_x2 :: Integer
arc\_y2 :: Integer
arc\_x3 :: Integer
arc\_y3 :: Integer

SplineLine:
spline\_common :: Common
spline\_cap\_style :: CapStyle

Arrow:
arrowType :: ArrowType
arrowStyle :: ArrowStyle
arrowThickness :: Double
arrowWidth :: Double
arrowHeight :: Double


ArrowStyle:
HollowArrow	 
FilledArrow	 


ArrowType:
Stick	 
Closed	 
Indented	 
Pointed	 


 
\subsection{Compound}\label{subsec:compound}


A line with object code 6 signifies the start of a compound.
    There are four more numbers on this line which indicate the
    upper right corner and the lower left corner of the bounding
    box of this compound.  A line with object code -6 signifies
    the end of the compound.  Compound may be nested.

   First line:

\begin{tabular}{|lll|}
\hline
type & name & Possible values or explanation \\
\hline
\hline
int & object-code             & always 6 \\
int & upperright-corner-y     & Fig units \\
int & lowerleft-corner-x      & Fig units \\
int & lowerleft-corner-y      & Fig units \\
\hline
\end{tabular}

 Subsequent lines:
        objects
        .
        .

    Last line:
        -6

Compound CompoundLine [Commented Object]	 
Polyline PolylineLine (Maybe Arrow) (Maybe Arrow) (Maybe Pic) [(Integer, Integer)]	 



PolylineLine:
polyline\_common :: Common
polyline\_join\_style :: JoinStyle
polyline\_cap\_style :: CapStyle
polyline\_radius :: Integer

JoinStyle:(Miter|JoinRound|Bevel)

CapStyle: see Section \ref{sec:param}


CompoundLine:
compound\_upperleft\_corner\_x :: Integer
compound\_upperleft\_corner\_y :: Integer
compound\_lowerright\_corner\_x :: Integer
compound\_lowerright\_corner\_y :: Integer






Common:
subType :: Integer
lineStyle :: LineStyle
lineThickness :: Integer
penColor :: ColorSpec
fillColor :: ColorSpec
depth :: Integer
penStyle :: Integer
areaFill :: AreaFill
styleVal :: Double

LineStyle:
LineStyleDefault	 
Solid	 
Dashed	 
Dotted	 
DashDotted	 
DashDoubleDotted	 
DashTripleDotted	 



AreaFill:(NoFill|Filled Integer|Pattern Integer)






\subsection{Picture}
Pic	 
pic\_flipped :: Flipped
pic\_file :: String

Flipped:(Normal|Flipped)



\section{Parameters}\label{sec:param}



used in ArcLine, SplineLine, PolylineLine
CapStyle:
Butt	 
CapRound	 
Projecting	 


used in Text and Common, 

ColorSpec:
ColorSpecDefault	 
Black	 
Blue	 
Green	 
Cyan	 
Red	 
Magenta	 
Yellow	 
White	 
Blue4	 
Blue3	 
Blue2	 
LtBlue	 
Green4	 
Green3	 
Green2	 
Cyan4	 
Cyan3	 
Cyan2	 
Red4	 
Red3	 
Red2	 
Magenta4	 
Magenta3	 
Magenta2	 
Brown4	 
Brown3	 
Brown2	 
Pink4	 
Pink3	 
Pink2	 
Pink	 
Gold	 
UserDefined Integer	 

\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
