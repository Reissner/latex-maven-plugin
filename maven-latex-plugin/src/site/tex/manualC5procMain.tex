
% !TEX root = manualLatexMavenPlugin.tex
\chapter{Processing of \LaTeX{} main files}\label{chap:latexMainConversions}

Given graphics in formats includable in TEX files, 
which may require preprocessing described in 
Chapter~\ref{chap:GraphConversions}, 
this section describes the conversions of latex main files 
into target files in detail. 
The most important target file format is \gls{pdf}. 
Conversion in this format is described in Section~\ref{sec:tex2pdf}. 
Note that \gls{pdf} also occurs as source format 
for included pictures and as intermediate files. 
Specific for \LaTeX{} is the \gls{dvi} format, 
which is supported mainly for historical reasons. 
% FIXME\@: nowhere described. 

Almost independent of the format created, 
Inclusion of bibliographies, indices and glossaries 
requires additional conversions 
done by several auxiliary programs. 
Bibliographies are described in Section~\ref{sec:bibtex}, 
indices in Section~\ref{sec:indices} 
and glossaries in Section~\ref{sec:glossaries}. 
Sections~\ref{sec:rerunMakeIndexGlossaries} 
and~\ref{sec:rerunLatex} 
are special in that they describe rerunning several programs, 
which may be necessary even if certain lists are present 
like table of contents list of figures or list of tables. 

Section~\ref{sec:chkReprod} is special in that it is not related with conversion 
but with checking reproducibility. 

Besides the output formats traditional for \LaTeX, 
\gls{pdf} and \gls{dvi} describing e.g.~books, 
Section~\ref{sec:tex2html} describes creation of 
\gls{html}, Section~\ref{sec:tex2odt} the creation of \gls{odt} and 
Section~\ref{sec:tex2doc} creation of MS Word formats like \gls{docx}. 
Finally, also pure text can be generated 
as described in Section~\ref{sec:tex2txt}. 

\newpage


\section{Transforming \LaTeX{} files into PDF files}\label{sec:tex2pdf}

The next step is to create a PDF file from the TEX files. 
\LaTeX{} distinguishes master TEX files from TEX files intended to be inputted
from elsewhere. 
Not tanking comments and that like into account, master TEX files have the form 
%
%\lstset{language=tex, basicstyle=\small}
\begin{lstlisting}[language=tex, basicstyle=\small]
\RequirePackage[l2tabu, orthodox]{nag} % optional 
\documentclass{...}

\begin{document}
...
\end{document}
\end{lstlisting}

To satisfy this task,
one may apply a \LaTeX{} to pdf converter \texttt{latex2pdf} 
to a master TEX file \texttt{xxx.tex}. 
The \LaTeX-to-pdf converter \texttt{latex2pdf} 
is configurable via the parameter \texttt{latex2pdfCommand}. 
Possible values are \texttt{lualatex}, \texttt{xelatex} and \texttt{pdflatex}, 
where the first is the default for which this software is also tested. 
It is also possible to pass parameters to the \LaTeX{} to pdf converter. 

In fact, the converter \texttt{latex2pdf} 
does much more than converting tex to pdf. 
Figure~\ref{fig:tex2pdf} shows for \texttt{latex2pdf} set to \texttt{lualatex}, 
that besides the PDF file also a log-file and an aux-file is created. 
The log-file contains logging information on the run of the conversion 
and the aux-file transports information from one run to the next. 
Thus, conversion goes without it, but it is read if present. 
This is why it is depicted at input side in dashed lines. 

What is in fact in the aux-file depends on the package. 
Among other information, 
also citations and the location of the bibliography file with ending bib 
are present. 
This cannot be used directly in the next \texttt{latex2pdf} run 
to create the bibliography, 
because the entries must be retrieved from the bib-file, 
collected and sorted. 
This is done by invoking \texttt{bibtex} between two \texttt{latex2pdf} runs. 
Based on the aux-file, \texttt{bibtex} creates a bbl-file 
containing the bibliography, which is read in the next \texttt{latex2pdf} run. 
For details see Section~\ref{sec:bibtex}. 

If an index is demanded, 
in addition \texttt{latex2pdf} creates a \gls{idx}-file. 
As the citations, it cannot be used directly to create an index in
the next \texttt{latex2pdf} run, 
because the index entries must be collected and sorted before. 
This is done by invoking \texttt{makeindex} 
between the two \texttt{latex2pdf} runs. 
Based on the IDX file, \texttt{makeindex} creates a \gls{ind}-file 
containing the index, which is read in the next \texttt{latex2pdf} run. 
For details see Section~\ref{sec:indices}. 

If a glossary is demanded, this can be read off the \gls{aux}-file 
and a \gls{glo}-file is created. 
As the index, it cannot be used directly to create a glossary in
the next \texttt{latex2pdf} run, 
because the glossary entries must be collected and sorted before. 
This is done by invoking \texttt{makeglossaries} 
between the two \texttt{latex2pdf} runs. 
Based on the glo-file, \texttt{makeglossaries} creates a \gls{gls}-file 
containing the glossary, which is read in in the next \texttt{latex2pdf} run. 
For details see Section~\ref{sec:glossaries}. 

In addition, if
a table of contents, a list of figures, a list of tables or a list of listings is required, 
also a toc-file, a lof-file, a lot-file and a lol-file is created,
respectively, 
collecting the according information. 
If such a file is present, it is read in and is used
to create a table of contents, a list of figures, of tables and of listings 
in the second run of \texttt{latex2pdf}. 

To summarize, 
if a table of contents, a list of figures, a list of tables or 
a bibliography, an index or a glossary is present, 
a second \LaTeX{} run is required to make them appear in the pdf-output. 

If a table of contents and at the same time 
a bibliography, an index or a glossary is present, 
even two further \LaTeX{} runs are required: 
After the first one, the bibliography, the index or the glossary 
occurs in the PDF file but not yet in the table of contents. 
This happens after the second additional \LaTeX{} run. 
As described in Sections~\ref{sec:rerunMakeIndexGlossaries} and~\ref{sec:rerunLatex}, 
further runs of \texttt{makeindex}, resp,~\texttt{splitindex}, 
\texttt{makeglossaries} 
and of the \LaTeX-processor \texttt{latex2pdf} may be necessary. 

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_01tex2pdf.ptx}
}
\caption{\label{fig:tex2pdf}Conversion of a TEX file into a PDF file 
(accordingly into a dvi-file)}
\end{figure}

\section{Bibliographies}\label{sec:bibtex}

In case the \LaTeX{}-to-pdf converter writes bibliographic information, 
into its aux-file, a bibliography must be generated. 
For each occurrence of a \cmd{cite}-command in the TEX file, 
\texttt{latex2pdf} writes an according entry \cmd{citation}. 
Moreover, a \cmd{bibliography}-command in the TEX file 
writes a link to the bib-file containing the bibliography data 
into the aux-file as \cmd{bibdata}. 
Optionally, a \cmd{bibliographystyle}-command in the TEX file 
writes a link to the bibliography style file 
into the aux-file as \cmd{bibstyle}. 

To create a bibliography, 
a \texttt{bibtexCommand} must be run after the \LaTeX{} run. 
The default command is the traditional \texttt{bibtex}, 
but there are more modern alternatives 
like \texttt{bibtexu} and \texttt{bibtex8} supporting utf8 encoding 
and others. 

% mention Biber and biblatex and also mlbibtex 

Essentially, \texttt{bibtex} extracts the citations in the aux-file, 
unifies them, i.e.~a citation is listed once even if it is used more than once, 
retrieves the according entries from the bib-file, sorts these, 
performs formatting and writes all into a bbl-file 
which can be included in the next run of \texttt{latex2pdf}. 

Note that after a \texttt{bibtex}-run, 
two \LaTeX{} runs are required: 
The first one just puts the bibliography found in the bbl-file 
into the PDF file and the labels of the citations into the aux-file 
as \cmd{bibcite}-commands. 
The second run places the labels of the citations found in the aux-file 
at the citations given by \cmd{cite}. 
The package \pkg{tocbibind} described in~\cite{TocBibIndP}, 
then writes the headline of the bibliography into the table of contents.\index{table of contents}
The package \pkg{rerunfilecheck} described in~\cite{RerunFChkP}, 
ensures that \texttt{latex2pdf} is rerun if needed, 
provided loaded with option \texttt{aux}. 


This software presupposes, that \texttt{bibtex} reads the aux-file 
and creates a bbl-file and also an blg-file with logging output 
as illustrated by Figure~\ref{fig:aux2bbl}. 
From the blg-file this software may determine 
whether \texttt{bibtex} emitted an error or warnings. 


\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_02aux2bbl.ptx}
}
\caption{\label{fig:aux2bbl}
Conversion of an aux-file into a bbl-file using a bibliography}
\end{figure}

Vital information on \texttt{bibtex} can be found in~\cite{BibPat} 
and in~\cite{BibMar}. 
Also, Chapter 10 in~\cite{Gra} gives vital information on \texttt{bibtex}. 


\section{Indices}\label{sec:indices}

In case the \LaTeX{} to pdf converter writes index information, 
into its IDX file, at least one index must be generated. 
Since the IDX file contains nothing but index information, 
an index is created if and only if the \gls{idx}-file is created. 
% Well, this is not really the truth: it is needed only if ...
Essentially, 
the command \cmd{makeindex}{} tells \texttt{latex2pdf} 
to open the IDX file for writing. 
Then for each occurrence of the \cmd{index}-command 
or similar (details see below) in the TEX file, 
an entry is written sequentially to the IDX file as 
\cmd{indexentry}{} comprising the keyword given by the \cmd{index}-command 
and the page number where the \cmd{index}-command occured. 
For example \cmd{index\{ant-task\}}{} creates an entry 
%
\begin{lstlisting}[language=TeX]
\indexentry{ant-task|hyperpage}{3}
\end{lstlisting}
%
in \texttt{xxx.idx}. 

Then the \texttt{makeindex}-command is applied to the IDX file 
which sorts keywords and for each keyword collects the according page numbers, 
sorts it and and writes the result into a \gls{ind}-file. 
In the next run of \texttt{latex2pdf}, 
the \cmd{prindindex}-command includes the index as a separate section; 
typically at the end of the PDF file. 
The most basic package to provide this command 
is \pkg{makeidx} described in~\cite{MkidxShIdxP}. 
In addition, \pkg{makeidx} provides the command \cmd{see}{} 
which is for cross-reference within an index. 
The package \pkg{tocbibind} described in~\cite{TocBibIndP}, 
then writes the headline of the index into the table of contents.\index{table of contents}
The package \pkg{rerunfilecheck} described in~\cite{RerunFChkP}, 
ensures that \texttt{latex2pdf} is rerun if needed, 
provided loaded with option \texttt{aux}. 

The same document,~\cite{MkidxShIdxP} 
also describes the package \pkg{showidx} 
which prints index entries at the margin of the document. 
This is for debugging only. 
\medskip


The main restriction of the package \pkg{makeidx} is, 
that only a single index can be created. 
The reason is that, \texttt{latex2pdf} creates a single IDX file 
and, as illustrated in Figure~\ref{fig:idx2ind}, 
\texttt{makeindex} creates a single ind-file from that, 
representing a single index. 

To overcome this restriction, 
replace package \pkg{makeidx} and \texttt{makeindex} 
with package \pkg{splitidx} and \texttt{splitindex} 
both described in~\cite{SplitidxP}. 

The package \pkg{splitidx} is used 
in conjunction with the program \texttt{splitindex}. 
It must be possible to create a single index 
without using \pkg{splitidx} and \texttt{splitindex}. **** 

Package option \texttt{split} makes \texttt{latex2pdf} 
creating IDX files \texttt{xxx-y.idx} directly. 
Here \texttt{y} represents the identifier of an individual index. 
These IDX files can be transformed individually with \texttt{makeindex} 
into ind-files as illustrated in Figure~\ref{fig:idx2indMult}. 
Since \texttt{latex2pdf} can keep open only up to 16 output streams, 
not all of which can be used to create a file \texttt{xxx-y.idx}, 
this approach allows a limited number of indices 
and is thus not recommended and not supported. 
Another reason is, that this approach undermines 
the package \pkg{rerunfilecheck} described in~\cite{RerunFChkP}, 
and so it is not guaranteed that \texttt{latex2pdf} is rerun if needed. 
This explains why option \texttt{split} is not allowed. 
% **** check? 

Instead, without option \texttt{split}, 
\texttt{latex2pdf} creates a single IDX file. 
The program \texttt{splitindex} splits it up into several IDX files 
and applies \texttt{makeindex} to each of them separately 
as illustrated in Figure~\ref{fig:idx2indSplit}. 

For usage of further packages supporting multiple indices 
which are not intended to be used with this software, 
see Chapter~\ref{chap:gaps}. 

This software presupposes, that \texttt{makeindex} converts the IDX file 
into an ind-file containing the index 
and creating also an ilg-file with logging output 
as shown in Figure~\ref{fig:idx2ind}. 
From the ilg-file this software may determine 
whether \texttt{makeindex} emitted an error or warnings. 

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_03idx2ind.ptx}
}
\caption{\label{fig:idx2ind}Conversion of an IDX file into an ind-file}
\end{figure}

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_04idx2indMult.ptx}
}
\caption{\label{fig:idx2indMult}
Not supported: Conversion of IDX files into ind-files}
\end{figure}

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_05idx2indSplit.ptx}
}
\caption{\label{fig:idx2indSplit}Conversion of an IDX file into ind-files}
\end{figure}

It is possible to configure the makeindex-command 
and to pass arbitrary options. 
CAUTION\@: For the usual \texttt{makeindex}-command, 
the options \texttt{-o} specifying an output file 
and \texttt{-t} (transcript) specifying the logging file are not allowed, 
because this breaks the expectation to find the sorted index 
in file \texttt{xxx.ind} 
and bypasses the detection of errors and warnings of this software, 
respectively. 
Also specifying a style file via option \texttt{-s} 
is not recommended because this is used to create a glossary 
and so breaks glossary creation 
as described in Section~\ref{sec:glossaries}. 

Information on the makeindex program can be found in~\cite{MkIdxMoe} 
and in~\cite{MkIdxLam}. 
Also, there is a site~\cite{MakeIdxOpts} 
describing all available options for \texttt{makeindex}. 

As indicated above, the program \texttt{splitindex} 
invokes \texttt{makeindex}. 
Its options are described in~\cite{SplitidxP}, Section~3.10. 
Since the long option names are not understood in all environments, 
only the short options are recommended. 

Since \texttt{splitindex} must satisfy the interface 
given by Figure~\ref{fig:idx2indSplit}, 
the option \texttt{--help} and its shortcut \texttt{-h} are not allowed. 
Likewise for option \texttt{--version} and its shortcut \texttt{-V}. 
The option \texttt{--makeindex <makeindex>}, resp.~\texttt{-m <makeindex>}, 
is used with the \texttt{makeindex} command used for single indices. 
Thus, this may not be given explicitly but is specified implicitly. 
Also, the option \texttt{--identify <regex>}, resp.~\texttt{-i <regex>} 
must be set implicitly because it must be the same expression 
as used to ***** 
Then splitindex.tlu is not allowed, 
because this has another expression. 

Only allowable seems \texttt{-V}, the shortcut for \texttt{--verbose}. 

Then comes the name of the index file to be processed 
without suffix. 

The program \texttt{splitindex} invokes \texttt{makeindex}. 
The option option \texttt{--} coming after the filename, 
indicates that all following options are passed to \texttt{makeindex} 



\section{Glossaries}\label{sec:glossaries}

Creating glossaries 
requires the package \pkg{glossaries} described in~\cite{GloP}. 
Note that despite the headline of this section, 
and despite \pkg{glossaries} itself supports multiple glossaries, 
this software supports only a single glossary 
and also sorting and unifying is done 
either via \texttt{makeindex} as for indices or via \texttt{xindy}, 
whereas the option to do without external programs 
offered also by package \pkg{glossaries} 
is not supported by this software. 

For generalizations see Chapter~\ref{chap:gaps}. 

As for creating indices there is a \LaTeX-command \cmd{makeindex}, 
to create a glossary there is a \LaTeX-command \cmd{makeglossaries}{}, 
but the latter is not built-in as \cmd{makeindex} 
but provided by the package \pkg{glossaries}. 
If \texttt{xxx.tex} is the \LaTeX{} main file, 
\cmd{makeglossaries}{} opens the glo-file \texttt{xxx.glo} 
containing glossary entries for writing. 
As the built-in command \cmd{index}{} 
writes entries into the IDX file defining the index, 
the command \cmd{gls}{} defined by the package \pkg{glossaries} 
writes an entry into the glo-file. 
Note that \texttt{xxx.glo} typically contains entries more than once 
and that the entries are not sorted. 

To perform sorting, formatting and typically also unification, 
the package \pkg{glossaries} allows three mechanisms. 
This software supports two of them: 
via the shell command \texttt{makeindex}, which is also used for indices, 
and via the shell command \texttt{xindy}. 
Using \texttt{makeindex} is the default but can also be activated through 
\cmd{usepackage[makeindex]\{glossaries\}}. 
Using \texttt{xindy} instead of \texttt{makeindex} is triggered through 
\cmd{usepackage[xindy]\{glossaries\}}. 
Accordingly, for option \texttt{makeindex} the aux-file receives lines 
%
\begin{lstlisting}[language=TeX]
\providecommand\@istfilename[1]{}
\@istfilename{manualLatexMavenPlugin.ist}
\end{lstlisting}
%
whereas for option \texttt{xindy}, there are lines 
%
\begin{lstlisting}[language=TeX]
\providecommand\@istfilename[1]{}
\@istfilename{manualLatexMavenPlugin.xdy}
...
\providecommand\@xdylanguage[2]{}
\@xdylanguage{main}{english}
\providecommand\@gls@codepage[2]{}
\@gls@codepage{main}{}
\end{lstlisting}



This software neither invokes \texttt{makeindex} nor \texttt{xindy} directly. 
Instead, it invokes the shell command \texttt{makeglossaries}
invoked without file ending  
which determines from the aux-file 
whether to invoke \texttt{makeindex} nor \texttt{xindy}. 
Accordingly, it writes the style definition 
by creating an ist-file \texttt{xxx.ist} or an xdy-file \texttt{xxx.xdy} 
if \texttt{makeindex} or \texttt{xindy} is specified as package option, 
respectively. 

Seemingly, \texttt{makeglossaries} relies on the aux-file 
to determine whether to invoke \texttt{makeindex} or \texttt{xindy} 
for sorting and unification. 
Then it invokes the according command and writes a log-file 
with ending \texttt{glg}, 
redirecting the logging output of \texttt{makeindex} or \texttt{xindy} 
adding own output so that a glg-file may be written, 
even if e.g.~\texttt{makeindex} is invoked and does not. 
In any case, if the glg-file is written, 
\texttt{makeglossaries} writes text matching 
%
\begin{verbatim}
(^\*\*\* unable to execute: )
\end{verbatim}
%
in the glg-file if an error occurs, 
no matter whether \texttt{makeindex} or \texttt{xindy} is invoked. 
Possibly, there are cases where an error causes no glg-file to be written. 
If no error occurs, a glg-file is written 
and if warnings are emitted, 
they either come from \texttt{makeindex} or from \texttt{xindy}. 
Thus warnings may be detected with the patterns 
defined by \texttt{makeindex} and by \texttt{xindy}. 

The style \texttt{list} (which is the default) is set in the form 
%
\begin{lstlisting}[language=TeX]
\usepackage[style=list]{glossaries}
\end{lstlisting}
%
where~\cite{GloP}, Section~15 lists predefined styles. 
So, the style determines the content of the style definition, 
whereas the options \texttt{makeindex} and \texttt{xindy} 
specify the form in which the style is encoded 
and thus the ending of the style file, 
which is either \texttt{ist} or \texttt{xdy}. 

Sorting the glo-file, as said above, 
currently is only supported using the command \texttt{makeglossaries}. 
The allowed options are essentially those 
making sense for \texttt{makeindex} and those making sense for \texttt{xindy}. 
If the shell command \texttt{makeglossaries} 
invokes \texttt{makeindex} of course only the according options 
are passed supplemented by additional options 
\texttt{-s}, \texttt{-t}, \texttt{-o}, to specify the
ist-file, the glg-file (the transcript-file) and the gls-file,
respectively, 
which is the result of sorting, the output file, 
and contains the entries of the glo-file 
just sorted, formatted and unified.
So for a tex main file \texttt{xxx.tex}
\texttt{makeglossaries} invokes
%
\begin{verbatim}
makeindex  -s "xxx.ist" -t "xxx.glg" -o "xxx.gls" "xxx.glo"
\end{verbatim}
%
Accordingly, if the shell command \texttt{makeglossaries} 
invokes \texttt{xindy} of course only the according options 
are passed supplemented by additional options 
\texttt{-M}, \texttt{-t}, \texttt{-o}. 
This is illustrated in Figure~\ref{fig:glo2gls}. 


\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_06glo2gls.ptx}
}
\caption{\label{fig:glo2gls}Conversion of a glo-file into a gls-file 
using \texttt{makeglossaries}}
\end{figure}


\section{Rerunning the index- and glossary processor}
\label{sec:rerunMakeIndexGlossaries}

As described in Section~\ref{sec:tex2pdf}, 
running a \LaTeX-to-pdf converter as \texttt{latex2pdf} 
may detect the presence of a bibliography, an index and/or of a glossary 
and writes raw files to describe them. 
After that, an intermediate step is required, 
sorting, unifying and formatting the entries. 
This is always done by an external program. 

In the next step the \LaTeX{} processor must read in the unified entries again. 
Whereas a \LaTeX-run does not affect the bibliography, 
it may well invalidate the page numbers 
of the entries of the index or of the glossary. 
Thus, the sorted index and glossary must be rebuild 
before the next \LaTeX{} run makes them visible in the PDF file. 

To that end, we use the package \pkg{rerunfilecheck}. 
%
\begin{lstlisting}[language=TeX]
\usepackage[index, glossary]{rerunfilecheck}
\end{lstlisting}
%
must be put before 
%
\begin{lstlisting}[language=TeX]
\usepackage{makeidx}
\makeindex
\usepackage[toc, xindy]{glossaries}
%, xindy or even [xindy={language=english,codepage=utf8}]
% mainly for index and glossaries 
\makeglossaries
\end{lstlisting}
%
in particular before \cmd{makeindex}{} and \cmd{makeglossaries}. 

Note that the package \pkg{hyperref} already loads \pkg{rerunfilecheck} 
but with the wrong options. 
Thus the above declaration must come before 
%
\begin{lstlisting}[language=TeX]
\usepackage[...]{hyperref}
\end{lstlisting}
%
to avoid error 
%
\begin{verbatim}
Option clash for package rerunfilecheck
\end{verbatim}


Package \pkg{rerunfilecheck} detects almost safely 
changes of the raw index file writing an according message 
into the log-file. 
That way, it can be determined whether it is necessary 
to rerun \texttt{makeindex} and \texttt{makeglossaries}. 
After that, of course \LaTeX{} must be rerun at least once. 
Note that Section~\ref{sec:rerunLatex} describes 
when to rerun \LaTeX{} without prior running *****

\section{Rerunning the \LaTeX{} processor}\label{sec:rerunLatex}

FIXME\@: a word on change in toc, lof, lot and lol. 

As indicated in the previous sections, 
\texttt{latex2pdf} must be rerun, 
if \texttt{bibtex} or \texttt{makeindex} \texttt{splitindex} 
or \texttt{makeglossaries} 
had been run 
to read in the bibliography created by \texttt{bibtex} 
or the index created by \texttt{makeindex} 
or the glossary created by \texttt{makeglossaries}. 
Likewise, if a toc-file, a lof-file, a lot-file or a lol-file
had been created in the first \texttt{latex2pdf} run, 
another run is needed to read in these files 
to create a table of contents, a list of figures or a list of tables, 
respectively. 
Note that for all these cases, 
the log-file does not allow to detect that \texttt{latex2pdf} has to be rerun, 
by matching a fixed pattern. 

After the second run of \texttt{latex2pdf}, 
the table of contents,
the list of figures, the list of tables and the list of listings 
are included and a section with the bibliography, 
the index and the glossary are inserted. 
It takes a third run of \texttt{latex2pdf} 
to include the bibliography the index and the glossary 
into the table of contents. 
Also it takes that third run to replace the citations 
with the proper labels given in the bibliography. 

Inserting the table of contents,
the list of figures, the list of tables and the list of listings 
may shift the subsequent text 
which may require another run of \texttt{latex2pdf} 
to get the page numbers right. 
As described in Section~\ref{sec:rerunMakeIndexGlossaries} 
intermediate runs of \texttt{makeindex} and \texttt{makeglossaries} 
may be required 
and these also require another run of \texttt{latex2pdf} 
also to get the page numbers right. 
The package \pkg{rerunfilecheck} allows to detect this need to rerun 
by pattern matching on the log-file almost for sure: 
Still there is some chance 
that the lengths and the md5-sum of all relevant files 
remain the same, although there is a relevant change. 
In this case, this software fails to update 
triggering another \texttt{latex2pdf} run. 


Note that there are several packages which require additional runs, 
such as the longtable-package, 
which may vary dimensions of tables. 
This software presupposes, that all these reruns 
may be detected by matching a fixed pattern in the log-file. 
Since packages are frequently changed and new packages are written, 
also the pattern cannot be fixed. 
Thus it is configurable. 
 
Note that, if a package requires running other programs 
between two runs of \texttt{latex2pdf}, 
this would require a change in this software. 

\section{Checking reproducibility}\label{sec:chkReprod}

There are use cases, where on the one hand side we want to deliver the sources 
but it is extremely important that the according artifacts are really reproducible. 
One obvious case is integration test for this software 
by ensuring that the created artifacts 
is equivalent with with a confirmed version. 


Currently, this is done for pdf files only. 
% TBD: change that 
The problem with pdf files is, that besides visible contents 
it contains also meta-data (see~\cite{pdf17}, Section 14.3), 
which depends on the run of the conversion. 
For example the timestamp of conversion goes into and so do many more aspects. 

There are two strategies to deal with the problem: 
%
\begin{itemize}
  \item 
  make the build process reproducible. 
  The advantage of this is that diffing is quite simple, fast and reproducible: 
  it is byte by byte. 
  This is easily done with a fixed installation but tends to break with update of tools. 
  % TBD: allow own version check. 
  Also at time of this writing, the different latex engines cannot be treated uniformly. 
  % TBD: a feature request to hyperref is already posted. 
  % let us keep an eye on that. 
  \item 
  use diff tools implementing a weaker notion of equivalence, 
  in a sense visibility equivalence of some degree. 
\end{itemize}

We support both approaches. 
The first one imposes requirements on the tex source file. 
It excludes that one displays a creation date changing each run. 
Listing~\ref{lst:designMeta} lower part illustrates that: 
We replaced the creation date by a ``version date''. 
A date can be only date of checkin of a version control system or that like. 
As an alternative, one could also refrain from using dates altogether. 
In the \texttt{\textbackslash date} command 
one could display also other pieces of information identifying the document. 

But the visible date is not all we have to avoid. 
Listing~\ref{lst:designMeta} shows how to eliminate metadata 
and to replace with adequate one. 
There is metadata which can be eliminated in a uniform way for all latex engines 
using the package \texttt{hyperref} which the author generally advises. 
Using\texttt{hyperref} with \texttt{\textbackslash hypersetup} 
one can set metadata such as author, title, subject and keyword 
as described in~\ cite{HyperTextP}, Section 5.8. 
On the other hand, 
one could eliminate \texttt{CreationDate} and \texttt{ModDate}. 
For newer versions of \texttt{pdflatex} this can be done alternatively 
with \texttt{\textbackslash pdfinfoomitdate1}. 

The metadata which can be eliminated only in a engine specific way 
are the PTEX keys including the banner, and the \texttt{pdftrailerid}. 
Note that the latter is {\em intentionally\/} 
a unique identifier for the individual document 
and so strictly speaking it is not advised to eliminate this 
but eliminating is necessary because it is incompatible with reproducibility. 
Note that \texttt{xelatex} seems not to write PTEX keys at all 
so only the \texttt{pdftrailerid} has to be eliminated or fixed. 

Unfortunately, the commands required to make a pdf file reproducible 
is not uniform among the tex to pdf converters. 
In fact, it works best with \texttt{lualatex} and sufficiently for \texttt{pdflatex} 
but support seems incomplete with \texttt{xelatex}. 


\begin{lstlisting}[language={[LaTeX]TeX}, basicstyle=\footnotesize,
  escapechar=|,
  float, captionpos=b, label={lst:designMeta}, 
  caption={Specifying meta-data for PDF files}]

% for pdflatex
\pdfsuppressptexinfo-1
% pdfsuppressptexinfo-1 is the same as pdfsuppressptexinfo15
% 1 -> PTEX.Fullbanner
% 2 -> PTEX.FileName
% 4 -> PTEX.PageNumber
% 8 -> PTEX.InfoDict (/Producer /Creator /CreationDate /ModDate /Trapped)
\pdftrailerid{}

% for lualatex: 
%   1 -> PTEX.FullBanner
%   2 -> PTEX.FileName
%   4 -> PTEX.PageNumber
%   8 -> PTEX.InfoDict
%  16 -> Creator
%  32 -> CreationDate
%  64 -> ModDate
% 128 -> Producer
% 256 -> Trapped
% 512 -> ID
\pdfvariable suppressoptionalinfo \numexpr32+64+512\relax

% for xelatex
\special{pdf:trailerid [
    <00112233445566778899aabbccddeeff>
    <00112233445566778899aabbccddeeff>
]}

% general
\usepackage{hyperref}
...
\hypersetup{
  pdfinfo={
    Author      ={Ernst Reissner},
    Title       ={The dvi-format and the program dvitype},
    CreationDate={unknown},
    ModDate     ={unknown},
    Subject     ={dvi and dvitype},
    Keywords    ={LaTeX;dvi;dvitype}
  }
}

% alternative for pdftex only
% \pdfinfoomitdate1
% \pdfsuppressptexinfo-1
% \pdftrailerid{}
% \pdfinfo{
%   /Author       (Ernst Reissner)
%   /Title        (The dvi-format and the program dvitype)
%   /CreationDate (unknown)
%   /ModDate      (unknown)
%   /Subject      (dvi and dvitype)
%   /Keywords     (LaTeX;dvi;dvitype)
%}
% Replacing pdfinfoomitdate1 in conjunction with
% usepackage[nodocdata=true,nopdftrailerid=true]{pdfprivacy}
% alternative 1 for pdftex only


\title{The dvi-format and the program dvitype}
\author{Ernst Reissner (rei3ner@arcor.de)}
\date{\versionDate}
\end{lstlisting}



If a user renounces independence of the engine and sticks to \texttt{pdflatex} only, 
the package \texttt{hyperref} 
could be replaced by specific commands. 
Also, using the package \texttt{iftex} one can detect the used engine 
via the macros \texttt{\textbackslash ifLuaTeX}, \texttt{\textbackslash ifXeTeX} 
and \texttt{\textbackslash ifPDFTeX} as illustrated in Listing~\ref{lst:reprPdfEngines}
and adapt the code to the engine. 

\lstinputlisting[language={[LaTeX]TeX}, basicstyle=\footnotesize,
firstline=14, lastline=42, 
breaklines,
%float, 
captionpos=b, label={lst:reprPdfEngines},
caption={Create reproducible pdf files for various engines}]%
{./manualLatexMavenPlugin.tex}


% TBD: insert listings how this document is made. 
For convenience also \texttt{pdfprivacy} described in~\cite{PdfPriv} can be used. 
\medskip


Now that we have described how to ensure reproducible pdf artifacts, 
just by designing the tex source appropriately, 
we have to explain how to check that a newly created artifact 
coincides with a blueprint provided a priori. 
First of all, note that currently such a check is performed 
only if the result is in pdf format. 
Even then the check is performed only if configured so. 
Then the actual artifacts are compared to predefined artifacts 
using a diff-tool. 
If the actual artifacts do not coincide with predefined ones 
according to the chosen diff tool, 
a build exception is thrown as specified in Table~\ref{tab:TLP}. 



\section{Creating hypertext}\label{sec:tex2html}

To create html and xhtml from TEX files (more precise from \LaTeX{} files), 
a \texttt{tex4htCommand}-command is used 
Together with its parameters, 
it is described in Section!\ref{sec:settingsLatex2Html}. 
This may be \texttt{htlatex}, the default based on \texttt{latex} 
and \texttt{htxelatex} based on \texttt{xelatex}. 

Figure~\ref{fig:tex2xml} shows the steps \texttt{htlatex} performs: 
From the input \LaTeX{} file \texttt{xxx.tex} 
another \LaTeX{} file \texttt{yyy.tex} is created 
which arises from \texttt{xxx.tex} by adding 
%FIXME\@: maybe instead: \RequirePackage which may be placed before documentclass
\begin{lstlisting}[language=TeX]
\usepackage[...]{tex4ht}. 
\end{lstlisting}
%
Then \texttt{htlatex} runs \texttt{latex} on \texttt{yyy.tex} 
which results in \texttt{yyy.dvi}. 
Note that this is in contrast to \texttt{lualatex} 
which would create some \texttt{yyy.pdf} unless otherwise specified. 

Then comes the converter \pkg{tex4ht} into the game 
which creates several html-files among those also \texttt{xxx.html}. 
The other files, \texttt{yyy.idv} and \texttt{yyy.lg}, 
are further processed by \texttt{t4ht} 
creating the stylesheet \texttt{xxx.css} and graphic files. 
\medskip


Let us make this more precise. 
The output of latex is a standard \gls{dvi}-file 
interleaved with special instructions 
for the post-processor \pkg{tex4ht} to use. 
Note that \pkg{tex4ht} is the name both of the post-processor 
and of the \LaTeX-package. 
The special instructions come from implicit and explicit requests 
made in the source file through commands for TeX4ht. 

The utility \pkg{tex4ht} translates the dvi-code into standard text, 
while obeying the requests it gets from the special instructions. 
The special instructions may request the creation of files, 
insertion of html code, filtering of pictures, and so forth. 
In the extreme case that the source code contains no commands of TeX4ht, 
\pkg{tex4ht} gets pure dvi-code and it outputs (almost) plain text 
with no hypertext elements in it.

The special (\cmd{special}) 
instructions seeded in the dvi-code 
are not understood by dvi processors other than those of TeX4ht.

\texttt{t4ht}
This is an interpreter 
for executing the requests made in the \texttt{xxx.lg} script.

\texttt{xxx.idv}
This is a dvi-file extracted from \texttt{xxx.dvi}, 
and it contains the pictures needed in the html files.

\texttt{xxx.lg}
This is a log file listing the pictures of \texttt{xxx.idv}, 
the \gls{png} files that should be created, CSS information, 
and user directives introduced 
through the ``\cmd{Needs\{\ldots\}}'' command.

\raggedbottom{}


\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_07tex2xml.ptx}
}
\caption{\label{fig:tex2xml}Conversion of a tex-file into an xml-file}
\end{figure}

\begin{Verbatim}[fontsize=\tiny]
(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/tex4ht.4ht
version 2009-01-07-07:11
--------------------------------------
Note --- for additional information, use the command line option `info'
--------------------------------------

(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4.4ht

Note: to remove the <?xml version=...?> processing instruction 
use the command line option `no-VERSION'

Note: to remove the DOCTYPE declaration 
use the command line option `no-DOCTYPE'
)

--------------------------------------
Note: for marking of the base font, use the command line option `fonts+'
Note: for non active _, use the command line option `no_'
Note: for _ of catcode 13, use the command line option `_13'
Note: for non active ^, use the command line option `no^'
Note: for ^ of catcode 13, use the command line option `^13'
--------------------------------------

(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4.4ht
--------------------------------------
Note: For section filenames that reflect on their titles 
use the command line option `sec-filename'

Note: for alternative charset, use the command line option `charset=...'

Note: to ignore CSS font decoration, use the `NoFonts' command line option

Note: for jpg bitmaps of pictures, 
use the `jpg' command line option. 
(Character bitmaps are controled only by `g' 
records of tex4ht.env and `-g' switches of tex4ht.c) 

Note: for gif bitmaps of pictures, use the `gif' command line option. 
(Character bitmaps are controled only by `g' 
records of tex4ht.env and `-g' switches of tex4ht.c) 

Note: for content and toc in 2 frames, 
use the command line option `frames'

Note: for content, toc, and footnotes in 3 frames, 
use the command line option `frames-fn'

Note --- for file extension name xht, use the command line option `xht'
--------------------------------------
TeX4ht package options: xhtml,uni-html4,2,pic-tabular,html
--------------------------------------
Note: to ignore CSS code, use the command line option `-css

Note: for inline CSS code, use the command line option `css-in'

Note: for pop ups on mouse over, use the command line option `mouseover'

Note: for addressing images in a subdirectory, 
use the command line option `imgdir:.../'
)

Note --- for back links to toc, use the command line option `sections+'

Note --- for linear crosslinks of pages, use the command line option `next'

(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/latex.4ht
version 2009-05-21-09:32
--------------------------------------
Note --- for links into captions, instead of float heads, use the command l
ine option `refcaption'
--------------------------------------

(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4.4ht
--------------------------------------
Note --- For mini tocs immediately aftter the header 
use the command line option `minitoc<'

Note --- for enumerated list elements with valued data, 
use the command line option `enumerate+'

Note --- for enumerated list elements li's with value attributes, use the c
ommand line option `enumerate-'

Note --- for CSS2 code, use the command line option `css2'

Note --- for bitmap fbox'es, use the command line option `pic-fbox'

Note --- for bitmap framebox'es, use the command line option `pic-framebox'

Note --- for inline footnotes use command line option `fn-in'

Note --- for tracing of latex font commands, 
use the command line option `fonts'
--------------------------------------
--------------------------------------
Note --- for width specifications of tabular p entries, 
use the `p-width' command line option 
or a configuration similar to 
\Configure{HColWidth}{\HCode{style="width:\HColWidth"}}
--------------------------------------
)
(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4-math.4ht
version 2009-05-18-23:01
--------------------------------------
Note --- for pictorial eqnarray, use the command line option `pic-eqnarray'

Note --- for pictorial array, use the command line option `pic-array'

Note --- for pictorial $...$ environments, 
use the command line option `pic-m' (not recommended!!)

Note --- for pictorial $...$ and $$...$$ environments with latex alt, 
use the command line option `pic-m+' (not safe!!)

Note --- for pictorial array, use the command line option `pic-array'
)
(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/unicode.4ht
version 2010-12-18-17:40
)
(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4-uni.4ht))


(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4.4ht
--------------------------------------
Note --- for tocs without * entries, use command line option `notoc*'

Note --- for tocs without * entries, use command line option `notoc*'

Note --- to eliminate mini tables of contents, 
use the command line option `nominitoc'

Note --- for frames-like object-based table of contents, 
use the command line option `obj-toc'

Note --- for files named derived from section titles, 
use the command line option `sec-filename'

Note --- for i-columns index, 
use the command line option `index=i' (e.g., index=2)
--------------------------------------
)

(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4.4ht

Note --- if included graphics are of degraded quality, 
try the command line options `graphics-num' or `graphics-'. 
The `num' should provide the density of pixels in the bitmaps (e.g., 110). 

Note --- for key dimensions try the option `Gin-dim'; 
for key dimensions when bounding box is unavailable 
try `Gin-dim+'; neither is recommended
)

(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4.4ht
Note --- for URL encoding within href use the command line option `url-enc'
)

(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4.4ht

Note --- for pictorial longtable, 
use the command line option `pic-longtable'
)

(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4.4ht

Note --- to ensure proper alignments use fixed size fonts (see listings.dtx
)
)
\end{Verbatim}
% LTeX: enabled=true

\pkg{tex4ht} yields 

\begin{Verbatim}[fontsize=\scriptsize]
----------------------------
tex4ht.c (2012-07-25-19:36 kpathsea)
tex4ht 
--- error --- improper command line
tex4ht [-f<path-separator-ch>]in-file[.dvi]
   [-.<ext>]            replacement to default file extension name .dvi
   [-c<tag name>]       choose named segment in env file
   [-e<env-file>]
   [-f<path-separator-ch>]        remove path from the file name
   [-F<ch-code>]        replacement for missing font characters; 0--255; default 0
   [-g<bitmap-file-ext>]
   [-h(e|f|F|g|s|v|V)]  trace: e-errors/warnings, f-htf, F-htf search
                            g-groups, s-specials, v-env, V-env search
   [-i<htf-font-dir>]
   [-l<bookkeeping-file>]
   [-P(*|<filter>)]     permission for system calls: *-always, filter
   [-S<image-script>]
   [-s<css-file-ext>]   default: -s4cs; multiple entries allowed
   [-t<tfm-font-dir>]
   [-u10]               base 10 for unicode characters
   [-utf8]              utf-8 encoding for unicode characters
   [-v<idv version>]    replacement for the given dvi version
   [-xs]           ms-dos file names for automatically generated gifs
\end{Verbatim}


\texttt{t4ht} yields 

\begin{Verbatim}[fontsize=\footnotesize]
--------------------------------------------------------------------
t4ht [-f<dir char>]filename ...
  -b     ignore -d -m -M for bitmaps
  -c...  choose named segment in env file
  -d...  directory for output files       (default:  current)
  -e...  location of tex4ht.env
  -i     debugging info
  -g     ignore errors in system calls
  -m...  chmod ... of new output files (reused bitmaps excluded)
  -p     don't convert pictures           (default:  convert)
  -r     replace bitmaps of all glyphs    (default:  reuse old ones)
  -M...  chmod ... of all output files
  -Q     quit, if tex4ht.c had problems
  -S...  permission for system calls: *-always, filter
  -X...  content for field %%3 in X scripts
  -....  content for field %%2 in . scripts

Example: 
   t4ht name -d/WWW/temp/ -etex4ht-32.env -m644
--------------------------------------------------------------------
\end{Verbatim}

\flushbottom

\section{Creating odt-files}\label{sec:tex2odt}

\section{Creating MS word files}\label{sec:tex2doc}

The best way to convert \LaTeX{} files into MS word files is via ODT files. 
Conversion from \LaTeX{} to odt 
is already described in Section~\ref{sec:tex2odt}. 
The last step can be done by \texttt{odt2doc} which can create both 
doc-format and docx-format and many others 
which is illustrated in Figure~\ref{fig:tex2doc}. 


\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_08tex2doc.ptx}
}
\caption{\label{fig:tex2doc}Conversion of a tex-file into a docx-file}
\end{figure}



\section{Creating plain text files}\label{sec:tex2txt}

Why should one create plain text from \LaTeX-files? 
Maybe this is the minimal format the receiver can work with. 
Another common application is word-count, 
in particular if writing a paper for a journal. 

Plain text files can be created from \LaTeX-files 
just by stripping off the tex-commands. 
The disadvantage is, 
that references, bibliography, index, glossary, 
table of contents, list of figures, list of tables, \dots 
and symbols get lost. 
Thus, the first step we take is complete creation of a pdf-file 
except display of warnings like bad boxes 
as described in Section~\ref{sec:tex2pdf}. 
This creates an appropriate pdf-file, 
with correct numberings and links, 
possibly with overfull boxes and that like. 
As a final step, we convert the pdf-file into a text file 
using, as a default \texttt{pdftotext} with ending \texttt{txt}. 
Figure~\ref{fig:tex2txt} illustrates the translation process. 

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_09tex2txt.ptx}
}
\caption{\label{fig:tex2txt}Conversion of a tex-file into an txt-file}
\end{figure}

Note that \texttt{pdftotext} produces a text file with page numbers 
and signifies the end of a page 
(to see how, just have a look at the end of the file), 
so that one can identify page numbers as such. 
Thus references, index, glossary, table of contents and that like 
referring to page numbers carry valuable information. 
Also symbols available in utf8 encoding are preserved. 
In contrast, heavily stacked formulae become unreadable, 
because \texttt{pdftotext} displays them line by line 
and drops fraction bars completely. 
Also, formulae with complex subformulae in a root operator  
become unreadable because the root operator becomes just a root symbol. 
Likewise for integrals and that like. 

Aspects of figures kept are the captions of course but also the \LaTeX-texts. 
This is displayed line-wise. 
What gets lost is the postscript/pdf-parts, i.e.~the plain graphics. 

\raggedbottom{}

