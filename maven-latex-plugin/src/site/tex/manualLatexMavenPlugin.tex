
\documentclass[12pt]{article}

\makeatletter
\@ifpackageloaded{tex4ht}{%
\usepackage[dvips]{xcolor}
\usepackage[dvips]{graphicx}
\usepackage[tex4ht]{hyperref}
}{%
\usepackage[pdftex]{xcolor}
\usepackage[pdftex]{graphicx}
\usepackage{hyperref}
}

\usepackage{longtable}
\usepackage{listings}
\usepackage{makeidx}

\title{Manual for the latex-maven-plugin and for an according ant task }
\author{Ernst Reissner (rei3ner@arcor.de)}

\makeindex

\begin{document}
\maketitle

\tableofcontents
\listoffigures
\listoftables


\section{Introduction}

This piece of software implements both an ant-task and a maven-plugin 
generating documentation of various formats from LaTeX files 
in an uniform way. 
In particular, the settings which may be passed to the task 
and those allowed for the plugin are in a one-to-one relation. 
They are both described in Section \ref{sec:settings}. 

Both, the ant-task and the maven-plugin rely on the same code base 
which form the package {\tt org.m2latex.core}. 
The code specific for the ant task is in {\tt org.m2latex.antTask} 
and that specific for the maven plugin is in {\tt org.m2latex.mojo}. 

It is very usual to endow LaTeX-files with figures. 
We support figures created in the xfig-format 
by the program xfig. 
Further make functionality on latex figures is not supported, 
but can be easily added. 
If there is some need, please write an email to the author. 

The creation process supports makeindex and bibtex. 
Again, further functionality can be added by demand. 

The present manual is created by the maven-pugin or the ant-task 
described here. 
There should be no difference in the result. 
This manual is designed in a way that it covers the most important features 
but also to demand the most important features. 
That way, creating this manual is a top level test 
for the underlying software. 


\section{Tools used by this Plugin and Task}\label{sec:tools}


\subsection{Conversion of fig-files}\label{subsec:fig2dev}

\index{fig2dev}
Currently, only figures drawn with {\tt xfig}, or, to be more precise, 
figures stored in .fig-files are supported. 
To export a file {\tt xxx.fig} into several external formats, 
xfig uses {\tt fig2dev}. 
Among others, {\tt fig2dev} supports export to mixed pdf and latex: 
graphics in pdf and text in latex which yields the fonts typical for latex. 
Accordingly, the export requires two commands and yields two files: 
%
\begin{verbatim}
fig2dev -L pdftex          xxx.fig xxx.pdf   
fig2dev -L pdftex_t -p pdf xxx.fig xxx.pdf_t
\end{verbatim}
%
yield {\tt xxx.pdf} and {\tt xxx.pdf\_t}, respectively, 
the latter containing latex and including the former. 
The file {\tt xxx.pdf\_t} is ``inputted'' into the tex-file. 
Note that this is appropriate for latex creating pdf-files, 
not postscript or dvi. 

Note that the option {\tt -L} is to specify the language, 
{\tt -p pdf} specifies portrait 
(also {\tt -l pdf} for landscape would be possible) 
and {\tt pdf} is ignored. 
For more options type {\tt fig2def -h} or consult the manual pages. 

Maybe xfig is intended to export from within the export dialog 
and not directly via a script like {\tt fig2dev}. 
This may be the reason 
why the magnification must be set in the export dialog, 
but it is stored in the fig-file nevertheless. 

Figure \ref{fig:fig2dev} shows the transformation of figures. 
Note that the {\tt fig2dev}-command is configurable 
via the parameter {\tt fig2devCommand}, 
but there will be hardly any command with the same command line interface 
performing exactly the transformations given in Figure \ref{fig:fig2dev}, 
except {\tt fig2dev} itself. 

\begin{figure}[htb]
\begin{center}
\input{1fig2dev.pdf_t}
\end{center}
\caption{\label{fig:fig2dev}Conversion of a fig-file into pdf and pdf\_t files}
\end{figure}

\subsection{Conversion of gnuplot-files}\label{subsec:gnuplot2pdf}

Plots drawn with {\tt gnuplot}, or, to be more precise, 
figures stored in .plt-files created by {\tt gnuplot} are supported. 
To export a file {\tt xxx.plt} into several external formats, 
uses {\tt gnuplot} itself. 
Among others, {\tt gnuplot} supports export to mixed pdf and latex: 
graphics in pdf and text in latex which yields the fonts typical for latex. 
Accordingly, the export requires two commands and yields two files: 
The command 
%
\begin{verbatim}
gnuplot -e  "set terminal cairolatex pdf;
             set output 'gnuplot.ptx';
             load 'gnuplot.plt'"
\end{verbatim}
%
exports {\tt xxx.plt} to {\tt xxx.ptx} and to {\tt xxx.pdf}, 
the former containing latex and including the latter. 
Note that this is appropriate for latex creating pdf-files, 
not postscript or dvi. 

FIXME: 
Here further options are missing: 
%   // set terminal pdf {monochrome|color|colour}
%    //                      {{no}enhanced}
%    //                      {fname "<font>"} {fsize <fontsize>}
%    //                      {font "<fontname>{,<fontsize>}"}
%    //                      {linewidth <lw>} {rounded|butt}
%    //                      {solid|dashed} {dl <dashlength>}}
%    //                      {size <XX>{unit},<YY>{unit}}

Figure \ref{fig:plt2pdf} shows the transformation of the plots 
and Figure \ref{fig:plt2pdf} shows an example of a gnuplot file 
embedded in this latex file. 
%Note that the {\tt fig2dev}-command is configurable 
%via the parameter {\tt fig2devCommand}, 
%but there will be hardly any command with the same command line interface 
%performing exactly the transformations given in Figure \ref{fig:fig2dev}, 
%except {\tt fig2dev} itself. 

\begin{figure}[htb]
\begin{center}
\input{2plt2pdf.pdf_t}
\end{center}
\caption{\label{fig:plt2pdf}Conversion of a gnuplot-file into a pdf-file}
\end{figure}

FIXME: why does gnuplot not work from within java, whereas standalone it does 

\begin{figure}[htb]
\begin{center}
%\input{3gnuplot.ptx}
\end{center}
\caption{\label{fig:gnuplot}
Converted sample gnuplot-file into ptx and pdf files }
\end{figure}



\subsection{Transforming (la)tex-files into pdf-files}\label{subsec:tex2pdf}

The next step is to create a pdf-file from the tex-files. 
LaTeX distinguishes master tex-files from tex-files intended to be inputted
from elsewhere. 
Master tex-files have the form 
%
\begin{lstlisting}
\documentclass{...}

\begin{document}
...
\end{document}
\end{lstlisting}

To satisfy this task, one may apply a latex to pdf converter {\tt latex2pdf} 
to a master tex-file {\tt xxx.tex}. 
The latex to pdf converter {\tt latex2pdf} 
is configurable via the parameter {\tt texCommand} 
(misleading name, I know, but short). 
Possible values are {\tt pdflatex}, {\tt lualatex} and {\tt xelatex}, 
where the first is the default for which this software is also tested. 
It is also possible to pass parameters to the latex to pdf converter. 

In fact, the converter {\tt latex2pdf} 
does much more than converting tex to pdf. 
Figure \ref{fig:tex2pdf} shows for {\tt latex2pdf} set to {\tt pdflatex}, 
that besides the pdf-file also a log-file and an aux-file is created. 
The log-file contains logging information on the run of the conversion 
and the aux-file transports information from one run to the next. 
Thus conversion goes without it but it is read if present. 
This is why it is depicted at input side in dashed lines. 

What is in fact in the aux-file depends on the package. 
Among other information, 
also citations and the location of the bibliography file with ending bib 
are present. 
This cannot be used directly in the next {\tt latex2pdf} run 
to create the bibiography, 
because the entries must be retrieved from the bib-file, 
collected and sorted. 
This is done by invoking {\tt bibtex} between two {\tt latex2pdf} runs. 
Based on the aux-file, {\tt bibtex} creates a bbl-file 
containing the bibliography, which is read in in the next {\tt latex2pdf} run. 
For details see Section \ref{subsec:bibtex}. 

If an index is demanded, in addition {\tt latex2pdf} creates an idx-file. 
As the citations, it cannot be used directly to create an index in
the next {\tt latex2pdf} run, 
because the index entries must be collected and sorted before. 
This is done by invoking {\tt makeindex} between the two {\tt latex2pdf} runs. 
Based on the idx-file, {\tt makeindex} creates an ind-file 
containing the index, which is read in in the next {\tt latex2pdf} run. 
For details see Section {subsec:makeindex}. 

In addition, 
if a table of contents, a list of figures or a list of tables is required, 
also a toc-file, a lof-file and a lot-file is created 
collecting the according information. 
If such a file is present, it is read in 
and is used to create a table of contents, a list of figures and of tables 
in the second run of {\tt latex2pdf}. 



\begin{figure}[htb]
\begin{center}
\input{4tex2pdf.pdf_t}
\end{center}
\caption{\label{fig:tex2pdf}Conversion of a tex-file into a pdf-file}
\end{figure}

\subsection{Bibliographies}\label{subsec:bibtex}

In case the latex to pdf converter writes bibliographic information, 
into its aux-file, a bibliography must be generated. 
Bibliographic information are 
citations, a link to the bib-file containing the bibliography data, 
and optionally a link to the bibliography style file. 

To create a bibliography, a {\tt bibtex}-command must be run. 
Essentially, {\tt bibtex} extracts the citations in the aux-file, 
unifies them, 
retrieves the according entries from the bib-file, sorts these 
and writes them into a bbl-file 
which can be included in the next run of {\tt latex2pdf}. 

This software presupposes, that {\tt bibtex} reads the aux-file 
and creates a bbl-file and also an blg-file with logging output 
as illustrated by Figure \ref{fig:aux2bbl}. 
From the blg-file this software may determine 
whether {\tt bibtex} emitted an error or warnings. 


\begin{figure}[htb]
\begin{center}
\input{5aux2bbl.pdf_t}
\end{center}
\caption{\label{fig:aux2bbl}
Conversion of an aux-file into a bbl-file using a bibliography}
\end{figure}

Vital information on {\tt bibtex} can be found in \cite{BibPat} 
and in \cite{BibMar}. 
Also Chapter 10 in \cite{Gra} gives vital information on {\tt bibtex}. 


\subsection{Indices}\label{subsec:makeindex}


In case the latex to pdf converter creates idx-file, 
an index must be generated. 
% Well, this is not really the truth: it is needed only if ...
To that end, a {\tt makeindex}-command must be run. 
Essentially, {\tt makeindex} sorts and combines index entries. 
This software presupposes, that {\tt makeindex} converts the idx-file 
into an ind-file containing the index 
and creating also an ilg-file with logging output 
as shown in Figure \ref{fig:idx2ind}. 
From the ilg-file this software may determine 
whether {\tt makeindex} emitted an error or warnings. 

\begin{figure}[htb]
\begin{center}
\input{6idx2ind.pdf_t}
\end{center}
\caption{\label{fig:idx2ind}Conversion of an idx-file into an ind-file}
\end{figure}

It is possible to configure the makeindex-command 
and to pass arbitrary options. 
CAUTION: For the usual {\tt makeindex}-command, 
the option {\tt -t} specifying the logging file is not allowed, 
because this bypasses the detection of errors and warnings of this software. 

Information on the makeindex program can be found in \cite{MkIdxMoe} 
and in \cite{MkIdxLam}. 

\subsection{Rerunning the latex processor}

As indicated in the previous sections, 
{\tt latex2pdf} must be rerun, if {\tt bibtex} or {\tt makeindex} had been run 
to read in the bibliography created by {\tt bibtex} 
or the index created by {\tt makeindex}. 
Likewise, if a toc-file, a lof-file or a lot-file 
had been created in the first {\tt latex2pdf} run, 
another run is needed to read in these files 
to create a table of contents, a list of figures or a list of tables, 
respectively. 
Note that for all these cases, 
the log-file does not allow to detect that {\tt latex2pdf} has to be rerun, 
by matching a fixed pattern. 

After the second run of {\tt latex2pdf}, 
the table of contents is included and the references and citations are
inserted 
which may shift the subsequent text 
which may require another run of {\tt latex2pdf} 
This may be detected by pattern matching on the log-file. 

Note that there are several packages which require additional runs, 
such as the longtable-package, 
which may vary dimensions of tables. 
This software presupposes, that all these reruns 
may be detected by matching a fixed pattern in the log-file. 
Since packages are frequently changed and new packages are written, 
also the pattern cannot be fixed. 
Thus it is configurable. 

Note that, if a package requires running other programs 
between two runs of {\tt latex2pdf}, 
this would require a change in this software. 


\subsection{Creating hypertext}

To create html and xhtml from latex files, 
a {\tt htlatex}-command is used. 
This may be {\tt htlatex}, the default based on {\tt latex} 
and {\tt htxelatex} based on {\tt xelatex}. 

Figure \ref{fig:tex2xml} shows the steps {\tt htlatex} performs: 
From the input latex file {\tt xxx.tex} 
another latex file {\tt yyy.tex} is created 
which arises from {\tt xxx.tex} by adding 
{\tt \textbackslash usepackage[...]\{tex4ht\}}. 
Then {\tt htlatex} runs {\tt latex} on {\tt yyy.tex} 
which results in {\tt yyy.dvi}. 
Note that this is in contrast to {\tt pdflatex} 
which would create some {\tt yyy.pdf}. 

Then comes the converter {\tt tex4ht} into the game 
which creates several html-files among those also {\tt xxx.html}. 
The other files, {\tt yyy.idv} and {\tt yyy.lg}, 
are further processed by {\tt t4ht} creating picture files 
and the stylesheet {\tt xxx.css}. 

The output of TeX is a standard dvi file 
interleaved with special instructions for the postprocessor tex4ht to use. 
The special instructions come from implicit and explicit requests 
made in the source file through commands of TeX4ht.

The utility {\tt tex4ht} translates the dvi code into standard text, 
while obeying the requests it gets from the special instructions. 
The special instructions may request the creation of files, 
insertion of html code, filtering of pictures, and so forth.

In the extreme case that the source code contains no commands of TeX4ht, 
{\tt tex4ht} gets pure dvi code and it outputs (almost) plain text 
with no hypertext elements in it.

The special ({\tt\textbackslash special}) instructions seeded in the dvi code 
are not understood by dvi processors other than those of TeX4ht.


{\tt xxx.idv}
This is a dvi file extracted from {\tt xxx.dvi}, 
and it contains the pictures needed in the html files.

{\tt xxx.lg}
This is a log file listing the pictures of {\tt xxx.idv}, 
the png files that should be created, CSS information, 
and user directives introduced 
through the ‘{\tt\textbackslash Needs\{...\}}’ command.


{\tt t4ht|
This is an interpreter 
for executing the requests made in the {\tt xxx.lg} script.

\begin{figure}[htb]
\begin{center}
\input{7tex2xml.pdf_t}
\end{center}
\caption{\label{fig:tex2xml}Conversion of a tex-file into an xml-file}
\end{figure}

\subsection{Creating odt-files}

\subsection{Creating MX word files}

\subsection{Creating plain text files}


\subsection{Miscellaneous}

Warning of failures occurs each time pdflatex is run. 
Restricting this to the first run is not appropriate, 
because the aux-file is read and so the failures may depend on the run. 


a





%\index{!!!!}
%\index{bla|(}
%\index{bla|)}





How to work on: First step: %
\begin{verbatim}
<cleanUp>false</cleanUp>
\end{verbatim}
Then have a look at the logging file. 


\section{Settings}\label{sec:settings}

This section describes the parameters 
of both the ant-task and the maven-plugin. 
After an overview in Section \ref{subsec:settingsOverview}, 
We give in depth explanations in Section \ref{subsec:settingsDetail}. 

\section{Overview and Listings}\label{subsec:settingsOverview}

First we provide a table, Table \ref{tab:parameters} 
with parameter names, default values 
and explanation, then listings of the configuration 
in the {\tt pom.xml} for the maven-plugin 
and in the {\tt build.xml} for the ant-task. 
The listing of the {\tt build.xml} shows 
which parameters are attributes and which ones are text elements. 
In {\tt pom.xml} only text elements occur. 
Note that neither of the parameters is mandatory, 
as there are always valid default values. 


\begin{longtable}{|ll|}
\hline
Parameter        & Default  \\
\multicolumn2{|l|}{Explanation }  \\
\hline
\hline
\multicolumn2{|l|}{directories, miscellaneous } \\
\hline
\tt texSrcDirectory  & \tt src/site/tex  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The tex source directory as a string, 
containing all tex main documents 
(including subfolders) to be processed
relative to {\tt\$baseDirectory}. 
The default value is '{\tt src/site/tex}' on Unix systems. 
\end{minipage}
} \\
\tt tempDirectory    & \tt m2latex       \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The working directory, 
for temporary files and LaTeX processing 
relative to {\tt \$targetDirectory} 
which is by default '{\tt\$baseDirectory/target}' on Unix systems. 
%The default value is '{\tt m2latex}'. 
\end{minipage}
} \\
\tt outputDirectory  & \tt .             \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The generated artifacts will be copied to {\tt outputDirectory}
relative to {\tt\$targetSiteDirectory} 
which is by default '{\tt\$targetDirectory/site}' on Unix systems. 
%The default value is '{\tt.}'.  
\end{minipage}
} \\
\tt targets          & \tt pdf, html     \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
A comma separated list of targets to be stored in {\tt\$targetSet}. 
%The default value is '{\tt pdf, html}'. 
\end{minipage}
} \\
\tt texPath          & {\tt null}         \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Path to the TeX scripts or {\tt null}. 
In the latter case, the scripts must be on the system path. 
Note that in the pom, the according empty element {\tt$<$texPath/$>$} 
even if written as {\tt $<$texPath$>$\ \ \ $<$/texPath$>$} 
represents the {\tt null}-File. 
%The default value is {\tt null}. 
\end{minipage}
} \\
\tt fig2devCommand   & \tt fig2dev  \index{fig2dev}     \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The fig2dev command for conversion of fig-files into various formats. 
Currently only {\tt pdf} combined with {\tt pdf\_t} is supported. 
%The default value is '{\tt fig2dev}'. 
\end{minipage}
} \\
\hline
\multicolumn2{|l|}{latex to pdf} \\
\hline
\tt texCommand       & \tt pdflatex      \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The LaTeX command to create a pdf-file. 
%The default value is '{\tt pdflatex}'. 
\end{minipage}
} \\
\tt texCommandArgs   & \tt\small -interaction=nonstopmode -src-specials  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The arguments string to use 
when calling LaTeX via {\tt\$texCommand}.
Leading and trailing blanks are ignored. 
A sequence of at least one blank separate the proper options. 
%The default value is 
%'{\tt-interaction=nonstopmode -src-specials}'. 
\end{minipage}
} \\
\tt patternErrLatex & see below \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern in the log-file 
indicating a failure when running the {\tt\$texCommand}. 
%The default value is 
%'{\tt ! $|$Fatal error$|$LaTeX Error$|$Emergency stop}'. 
If this is not complete, please extend 
and notify the developer of this plugin. 
\end{minipage}
} \\
\tt debugbadboxes    & \tt true          \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Whether debugging of overfull/underfull hboxes/vboxes is on: 
If so, a bad box occurs in the last LaTeX run, a warning is displayed. 
For details, set {\tt\$cleanUp} to false, 
rerun LaTeX and have a look at the log-file.
%The default value is '{\tt true}'. 
\end{minipage}
} \\
\tt debugwarnings    & \tt true          \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Whether debugging of warnings is on: 
If so, a warning in the last LaTeX run is displayed. 
For details, set {\tt\$cleanUp} to false, 
rerun LaTeX and have a look at the log-file. 
%The default value is '{\tt true}'. 
\end{minipage}
} \\
\hline
\multicolumn2{|l|}{makeindex} \\
\hline
\tt bibtexcommand    & \tt bibtex        \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The BibTeX command to create a bbl-file 
from an aux-file and a bib-file (using a bst-style file). 
%The default value is '{\tt bibtex}'. 
\end{minipage}
} \\
\tt patternErrBibtex    & \tt error message        \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The Pattern in the blg-file 
indicating that \$bibtexCommand failed. 
The default value is chosen 
according to the 'bibtex' documentation. 
\end{minipage}
} \\
\tt patternWarnBibtex    & \tt Warning--        \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The Pattern in the blg-file 
indicating a warning \$bibtexCommand emitted. 
The default value is chosen 
according to the 'bibtex' documentation. \end{minipage}
} \\
\multicolumn2{|l|}{makeindex} \\
\hline
\tt makeIndexCommand & \tt makeindex     \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The MakeIndex command to create an ind-file from an idx-file 
logging on an ilg-file. 
%The default value is '{\tt makeindex}'. 
\end{minipage}
} \\
\tt makeIndexOptions & \tt the empty string     \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options for the MakeIndex command. 
% The default value is the empty string. 
\end{minipage}
} \\
\tt patternErrMakeindex & !! Input index error         \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern in the ilg-file 
indicating that \$makeIndexCommand failed. 
The default value is chosen 
according to the 'makeindex' documentation.
\end{minipage}
} \\
\tt patternWarnMakeindex & \#\# Warning         \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern in the ilg-file 
indicating a warning \$makeIndexCommand emitted. 
The default value is chosen 
according to the 'makeindex' documentation.
\end{minipage}
} \\
\hline
\multicolumn2{|l|}{htlatex} \\
\hline
\tt tex4htCommand       & \tt htlatex  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
\end{minipage}
} \\
\tt tex4htStyOptions    & \tt xhtml,uni-html4,2,svg  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
\end{minipage}
} \\
\tt tex4htOptions       & \tt -cunihtf -utf8         \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
\end{minipage}
} \\
\tt t4htOptions         & the empty string              \\%-cvalidate
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options for 't4ht' which converts idv-file and lg-file 
into css-files, tmp-file and, 
by need and if configured accordingly into png files. 
The value '-p' prevents creation of png-pictures.
%The default value is the empty string. 
\end{minipage}
} \\
\tt patternNeedLatexReRun &  see below ****          \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern in the log file which triggers rerunning latex. 
This pattern may never be ensured to be complete, 
because any new package may break completeness. 
Nevertheless, the default value aims completeness 
while be restrictive enough not to trigger another latex run if not needed. 
To ensure termination, let \$maxNumReruns 
specify the maximum number of latex runs. 
If the user finds an extension, (s)he is asked to contribute 
and to notify the developer of this plugin. 
Then the default value will be extended. 
\end{minipage}
} \\
\tt maxNumReruns        & \tt 5               \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The maximal allowed number of reruns of the latex process. 
This is to avoid endless repetitions. 
%The default value is 5. 
This shall be non-negative 
or -1 which signifies that there is no threshold. 
\end{minipage}
} \\
\tt latex2rtfCommand    & \tt latex2rtf        \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The latex2rtf command to create rtf from latex directly. 
%The default value is '{\tt latex2rtf}'. 
\end{minipage}
} \\
\tt odt2docCommand      & \tt odt2doc          \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The odt2doc command to create MS word-formats from otd-files. 
%The default value is '{\tt odt2doc}'. 
\end{minipage}
} \\
\tt odt2docOptions      & \tt -fdocx          \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options of the odt2doc command. 
Above all specification of output format via the option '-f'. 
The odt2doc command is invoked in the form 
'{\tt odt2doc -f$<$format$>$ $<$file$>$.odt}'. 
All output formats are shown by '{\tt odt2doc --show}' 
but the formats interesting in this context 
are the following: 
{\tt doc}, {\tt doc6}, {\tt doc95}, {\tt docbook}, {\tt docx}, 
{\tt docx7}, {\tt ooxml} and {\tt rtf}. 
Interesting also the verbosity options '{\tt -v}', '{\tt -vv}', '{\tt -vvv}' 
the timeout '{\tt -T=secs}' and '{\tt --preserve}' 
to keep permissions and timestamp of the original document. 
%The default value is '{\tt -fdocx}'. 
\end{minipage}
} \\
\tt pdf2txtCommand      & \tt pdftotext        \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pdf2txt command converting pdf into plain text. 
The default value is '{\tt pdftotext}'. 
\end{minipage}
} \\
\tt pdf2txtOptions      & the empty string  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options of the pdf2txt command. 
%The default value is the empty string. 
\end{minipage}
} \\
\tt cleanUp             & \tt true             \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Clean up the working directory in the end? 
May be used for debugging when setting {\tt false}. 
%The default value is '{\tt true}'. 
\end{minipage}
} \\
\hline
\caption{\label{tab:parameters} The parameters of task and plugin }
\end{longtable}



The maven-plugin described here, 
requires the following definition in {\tt pom.xml}. 

\lstset{language=xml, basicstyle=\tiny}
\begin{lstlisting}
\small
        <!-- create html and pdf and other formats from latex -->
      <plugin>
	<groupId>de.akquinet.jbosscc.latex</groupId>
	<artifactId>latex-maven-plugin</artifactId>
	<version>1.3-SNAPSHOT</version><!--uptodate?-->
	<!--artifactId>maven-latex-plugin</artifactId>
	    <version>1.2</version--><!--uptodate?-->
	
	<configuration>
          <settings>
            <!-- The tex source directory as a string, containing 
		 all tex main documents (including subfolders) to be processed
		 relative to $baseDirectory. 
		 The default value is 'src/site/tex' on Unix systems. -->
            <texSrcDirectory>src/site/tex</texSrcDirectory>

            <!-- The working directory, 
		 for temporary files and LaTeX processing 
		 relative to $targetDirectory 
		 which is by default '$baseDirectory/target' on Unix systems. 
		 The default value is 'm2latex'. -->
            <tempDirectory>m2latex</tempDirectory>

            <!-- The generated artifacts will be copied to this folder 
		 relative to $targetSiteDirectory 
		 which is by default '$targetDirectory/site' on Unix systems. 
		 The default value is '.'.  -->
            <outputDirectory>.</outputDirectory>

	    <!-- A comma separated list of targets 
		 to be stored in $targetSet. 
		 The default value is 'pdf, html'. -->
	    <targets>pdf, html</targets>

           <!-- Path to the TeX scripts or null. 
		In the latter case, the scripts must be on the system path. 
		Note that in the pom, <texPath/> 
		and even <texPath>    </texPath> represent the null-File. 
		The default value is null. -->
            <texPath/> 

	    <!-- The fig2dev command for conversion of fig-files 
		 into various formats. 
		 Currently only pdf combined with pdf_t is supported. 
		 The default value is 'fig2dev'.  -->
	    <fig2devCommand>fig2dev</fig2devCommand>
  
            <!-- The LaTeX command to create a pdf-file. 
		 The default value is 'pdflatex'. -->
            <texCommand>pdflatex</texCommand>

             <!-- The arguments string to use 
		  when calling latex via $texCommand 
		  Leading and trailing blanks are ignored. 
		  A sequence of at least one blank separate the proper options. 
		  The default value is 
		  '-interaction=nonstopmode -src-specials'. -->
            <texCommandArgs>
	      -interaction=nonstopmode -src-specials
	    </texCommandArgs>

	    <!-- The pattern in the log-file 
		 indicating a failure when running $texCommand. 
		 The default value is 
		 'Fatal error|LaTeX Error|Emergency stop'. 
		 If this is not complete, please extend 
		 and notify the developer of this plugin. -->
	    <patternErrLatex>
	      ! |Fatal error|LaTeX Error|Emergency stop|LaTeX exited abnormally
	    </patternErrLatex>

	    <!-- Whether debugging of overfull/underfull hboxes/vboxes is on: 
		 If so, a bad box occurs in the last LaTeX run, 
		 a warning is displayed. 
		 For details, set $cleanUp to false, 
		 rerun LaTeX and have a look at the log-file.
		 The default value is 'true'. -->
	    <debugBadBoxes>true</debugBadBoxes>

	    <!-- Whether debugging of warnings is on: 
		 If so, a warning in the last LaTeX run is displayed. 
		 For details, set $cleanUp to false, 
		 rerun LaTeX and have a look at the log-file. 
		 The default value is 'true'. -->
	    <debugWarnings>true</debugWarnings>


            <!-- The BibTeX command to create a bbl-file 
		 from an aux-file and a bib-file (using a bst-style file). 
		 The default value is 'bibtex'. -->
            <bibtexCommand>bibtex</bibtexCommand>

	    <!-- The Pattern in the blg-file 
		 indicating that $bibtexCommand failed. 
		 The default value is chosen 
		 according to the 'bibtex' documentation. -->
	    <patternErrBibtex>error message</patternErrBibtex>

	    <!-- The Pattern in the blg-file 
		 indicating a warning $bibtexCommand emitted. 
		 The default value is chosen 
		 according to the 'bibtex' documentation. -->
	    <patternWarnBibtex>Warning--</patternWarnBibtex>

	    <!-- The MakeIndex command to create an ind-file 
		 from an idx-file logging on an ilg-file. 
		 The default value is 'makeindex'. -->
	    <makeIndexCommand>makeindex</makeIndexCommand>

	    <!-- The options for the MakeIndex command. 
		 The default value is the empty string. -->
	    <makeIndexOptions></makeIndexOptions>

	    <!-- The pattern in the ilg-file 
		 indicating that $makeIndexCommand failed. 
		 The default value is chosen 
		 according to the 'makeindex' documentation.  -->
	    <patternErrMakeindex>!! Input index error </patternErrMakeindex>
 
 	    <!-- The Pattern in the ilg-file 
		 indicating a warning $makeIndexCommand emitted. 
		 The default value is chosen 
		 according to the 'makeindex' documentation. -->
	    <patternWarnMakeindex>## Warning </patternWarnMakeindex>

           <!-- the tex4ht command htlatex-->
            <tex4htCommand>htlatex</tex4htCommand>

	    <!-- options for tex4ht.sty
		 Format: 
		 <Output format>, <index>, <depth>, 
		 ['info'], ['next'], ['fn-in'], ['frames'], 
		 ['pmathml'], ['pmathml-css'], ...
		 
		 options in [] are optional 
		 DEFAULT: html,2 
		 Available formats are html, xhtml, mathml, ooffice 
		 index=2  index in 2 columns. 
		 depth is the depth of sectioning 
		 to which separate files are created. 
		 fn-in specifies inline footnotes 
		 frames specifies separate frames for contents and toc 
		 mathml specifies mathml 
		 uni-html4 is used for unicode
	    -->
	    <!-- xhtml,uni-html4,0 mathml,-->
            <tex4htStyOptions>xhtml,uni-html4,2,svg</tex4htStyOptions>

	    <!-- options for tex4ht.c, default is empty -->
	    <!-- ' -cunihtf' forces unicode -->
            <tex4htOptions> -cunihtf -utf8</tex4htOptions>

	    <!-- The options for 't4ht' which converts idv-file and lg-file 
		 into css-files, tmp-file and, 
		 by need and if configured accordingly into png files. 
		 The value <code>-p</code> prevents creation of png-pictures.
		 The default value is the empty string. -->
            <t4htOptions>-cvalidate</t4htOptions>

	    <!-- The pattern in the log file which triggers rerunning latex. 
		 This pattern may never be ensured to be complete, 
		 because any new package may break completeness. 
		 Nevertheless, the default value aims completeness 
		 while be restrictive enough not to trigger another latex run 
		 if not needed. 
		 To ensure termination, let $maxNumReruns 
		 specify the maximum number of latex runs. 
		 If the user finds an extension, (s)he is asked to contribute 
		 and to notify the developer of this plugin. 
		 Then the default value will be extended. -->
	    <patternNeedLatexReRun>
	      (Rerun (LaTeX|to get cross-references right)|
	      There were undefined references|
\\(rerunfilecheck\\)                Rerun to get outlines right|
Package longtable Warning: Table widths have changed. Rerun LaTeX.|
	      Package natbib Warning: Citation\\(s\\) may have changed)
	    </patternNeedLatexReRun>

	    <!-- The maximal allowed number of reruns of the latex process. 
		 This is to avoid endless repetitions. 
		 The default value is 5. 
		 This shall be non-negative 
		 or -1 which signifies that there is no threshold. -->
	    <maxNumReruns>-1</maxNumReruns>

            <!-- The latex2rtf command to create rtf from latex directly. 
		 The default value is 'latex2rtf'. -->
	    <latex2rtfCommand>latex2rtf</latex2rtfCommand>

            <!-- The odt2doc command to create MS word-formats from otd-files. 
		 The default value is 'odt2doc'. -->
	    <odt2docCommand>odt2doc</odt2docCommand>

	    <!-- The options of the odt2doc command. 
		 Above all specification of output format via the option '-f'. 
		 Invocation is 'odt2doc -f<format> <file>.odt'. 
		 All output formats are shown by 'odt2doc - -show' 
		 but the formats interesting in this context 
		 are doc, doc6, doc95,docbook, docx, docx7, ooxml, rtf. 
		 Interesting also the verbosity options '-v', '-vv', '-vvv' 
		 the timeout '-T=secs' and '- -preserve' 
		 to keep permissions and timestamp of the original document. 
		 The default value is '-fdocx'. -->
	    <odt2docOptions>-fdocx</odt2docOptions>

	    <!-- The pdf2txt command converting pdf into plain text. 
	    	 The default value is 'pdftotext'.  -->
            <pdf2txtCommand>pdftotext</pdf2txtCommand>

	    <!-- The options of the pdf2txt command. 
		 The default value is the empty string. -->
            <pdf2txtOptions></pdf2txtOptions>

            <!-- Clean up the working directory in the end? 
		 May be used for debugging when setting false. 
		 The default value is 'true'. -->
            <cleanUp>true</cleanUp>

 	  </settings>
	</configuration>

	<executions>
          <!-- execute latex goal automatically during the site phase -->
          <execution><!-- DEFAULT -->
            <phase>site</phase>
            <goals>
              <goal>pdf</goal>
              <goal>html</goal>
              <!--goal>rtf</goal-->
              <!--goal>odt</goal-->
              <!--goal>doc</goal-->
              <!--goal>txt</goal-->
 <!--
here is a bug affecting goal odt: 
/usr/local/texlive/2014/texmf-dist/tex/generic/pgf/systemlayer/pgfsys-tex4ht.def
89c89
 \def\pgfsys@svg@newline{{?nl}} % replacement 
- - -
 \def\pgfsys@svg@newline{\Hnewline} % original 
-->
              <goal>odt</goal>
              <goal>cfg</goal>
            </goals>
          </execution>
	</executions>
      </plugin>
\end{lstlisting}

It has to be placed in the build element where below dots are given. 

\begin{lstlisting}
  <build>
    <plugins>
      ....
    </plugins>
  </build>
\end{lstlisting}


The ant-task described here, 
requires the following target and task definition in {\tt build.xml}. 

\begin{lstlisting}
  <taskdef name="latex"
	   classname="org.m2latex.antTask.LatexTask"
	   classpathref="latex.classpath"/>

  <target name="pdf"
	  description="create pdf from latex. ">
    <latex>
      <!-- missing: baseDirectory, targetDirectory, targetSiteDirectory,
	   texPath = null -->
      <settings texSrcDirectory="src/site/tex"
		tempDirectory="m2latex"
		outputDirectory="."
		targets="pdf, html"
		fig2devCommand="fig2dev"
		texCommand="pdflatex"
		texCommandArgs="-interaction=nonstopmode -src-specials"
		debugBadBoxes='true'
		debugWarnings='true'
		bibtexCommand="bibtex"
		makeIndexCommand="makeindex"
		makeIndexOptions=""
		tex4htCommand="htlatex"
		tex4htStyOptions="html,uni-html4,2,svg"
		tex4htOptions=" -cunihtf -utf8"
		t4htOptions="-cvalidate"
		maxNumReruns='-1'
		latex2rtfCommand="latex2rtf"
		odt2docCommand="odt2doc"
		odt2docOptions="-fdocx"
		pdf2txtCommand="pdftotext"
		pdf2txtOptions=""
		cleanUp='true'>
	<!-- texPath is null -->
	
	<patternErrLatex>
	  ! |Fatal error|LaTeX Error|Emergency stop|LaTeX exited abnormally
	</patternErrLatex>
	<patternErrBibtex>error message</patternErrBibtex>
	<patternWarnBibtex>Warning--</patternWarnBibtex>
	<patternErrMakeindex>!! Input index error </patternErrMakeindex>
	<patternWarnMakeindex>## Warning </patternWarnMakeindex>
	<patternNeedLatexReRun>
	  (Rerun (LaTeX|to get cross-references right)|
	  There were undefined references|
	  \(rerunfilecheck\)                Rerun to get outlines right|
	  Package longtable Warning: Table widths have changed. Rerun LaTeX.|
	  Package natbib Warning: Citation\(s\) may have changed)
	</patternNeedLatexReRun>
      </settings>
    </latex>
  </target>
\end{lstlisting}

\subsection{Details}\label{subsec:settingsDetail}

Note that all parameters have default values 
and that thus neither has to be specified explicitly. 
We now discuss the individual parameters in depth. 

TODO: do this. 

\section{Goals}

%\begin{longtable}

%\end{longtable}

\section{Installation}

Both the ant-task and the maven-plugin just direct parameters 
from ant and from maven, respectively, 
to the programs that do the proper work. 
Thus installation of the ant-task and of the maven plugin 
requires that all needed programs are installed. 
These prerequisites are collected in Section \ref{subsec:prerequisites}. 


\subsection{Prerequisites}\label{subsec:prerequisites}

The ant-task is tested with 
{\tt Apache Ant(TM) version 1.9.4 compiled on September 11 2015}
and the maven-plugin with 
%
\begin{verbatim}
Apache Maven 3.2.1
(ea8b2b07643dbb1b84b6d16e1f08391b666bc1e9; 
2014-02-14T18:37:52+01:00). 
\end{verbatim}
The java version is {\tt 1.8.0\_101, vendor: Oracle Corporation}. 

So, a java installation is the base for running either the ant-task 
or the maven-plugin. 
To use the maven-plugin, of course maven must be installed 
and to use the ant-task, ant must be installed. 

The ant-task just passes parameters in the build file to the core 
and accordingly the maven-plugin passes parameters in the pom 
to the core. 
The core just invokes various programs to do the actual work. 

To process the fig-files, by default {\tt fig2dev} is used. \index{fig2dev}
It makes sense to have {\tt xfig} installed, but this is not mandatory. 

To create pdf-files from latex files we use {\tt pdflatex} 
or some other kind of latex creating pdf-files. 
LaTeX uses several auxiliary programs. 
Above all {\tt bibtex} to create the bibliography 
and {\tt makeindex} for the index. 

To create html-files, or to be more precise any kind of sgml and xml, 
from pdf-files, {\tt htlatex} is used. 
This includes also creating open office documents like odt-files. 
Thus open office documents are created in two steps, 
the first is to create pdf-files with the according tools, 
the second one is done by {\tt htlatex}. 

To create rtf-files, currently {\tt latex2rtf} is used. 
Note that this does not require {\tt pdflatex}. 
As a drawback, not all latex-packages are supported. 

MS word documents are created from open office documents via {\tt odt2doc} 
and thus require three steps. 

Finally, there is a way, to create plain text files from the pdf-files 
via {\tt pdftotext}. 
The way from latex to text via pdf makes sense 
because that text is well formatted 
and may contain unicode symbols like $\pi$. 

So to run this software, the abovementioned programs must be installed. 

\subsection{Setting pom.xml and build.xml}\label{subsec:sgml}

To install the maven-plugin within a given maven project, 
the according listing given in Section \ref{sec:settings} 
has to be added to the {\tt pom.xml} 
and accordingly to install the ant-task within an ant-project, 
the according listing given in Section \ref{sec:settings} 
has to be added to the {\tt build.xml} 

\subsection{Completing the Installation}\label{subsec:instComplete}

To install the maven-plugin, just type {\tt mvn clean install}. 
To install the ant-task, one has first to comment out in {\tt build.xml} 
the taskdef {\tt latex} and the target {\tt latex:cfg}. 
One may also adapt the lib-folder of the ant-installation, 
i.e. the property {\tt antJarDir} where {\tt ant.jar} resides. 
Then just type {\tt ant clean jar} 
which creates the jar-file (property {\tt createdJar}) defining the ant-task. 
After that one may copy the created jar into folder {\tt antJarDir}, 
where ant finds it typing {\tt sudo ant install}. 

Note that, if maven is installed, the command {\tt mvn clean install} 
also creates the jar-file {\tt createdJar} defining the ant-task. 
Also with this method, one has to copy the jar-file defining the ant-task 
later into ant's lib-folder. 

After having installed the ant-task, 
reactivate the taskdef {\tt latex} and the target {\tt latex:cfg} 
and run {\tt ant latex:cfg} to create this manual. 

Mixing ant and maven builds is not so good. 
One may always recover by just creating with maven. 

\section{Gaps}

Only figures created with xfig and stored as files pdf and pdf\_t 
may be integrated into a latex document. 
This could be extended to a broader variety of export file formats. 
The problem is, that fig-files to not contain information on the export
format. 
This has to be either given elsewhere in a config file 
or determined by pre-parsing the tex-files. 

It is also desirable to add support for further figure creation software, 
other than xfig. 

There is no proper make-mechanism taking dependencies into account. 
Thus all documents in all formats specified are remade, 
whether they changed or not. 

Also, if more than one target is created from one latex source, 
common steps are redone for each target. 
E.g. if pdf and html are created, 
pdf creation is done twice and if pdf, html, odt and docx are created, 
odt is done twice (once for odt second for docx) 
and pdf is done even trice: 
once for pdf itself, once for odt and once for docx. 

No glossary is supported. 
Creating more than one index is not supported. 
To that end, makeindex has to be invoked with an argument 
specifying the type of index. 

The ant-task does not allow to create single formats, e.g. pdf selectively. 


In my opinion, it would be desirable not to copy the tex sources into a
working directory. 
That way one could use the maven plugin 
not only for final creation of documentation 
but it could better support development of the documentation. 

The ant-build is not finished: tests are not run and 
test runs are no prerequisite for installation. 

This manual is not finished. 
To test the overall functionality of the maven-plugin and of the ant-task 
described here, this manual is created through plugin and task. 



\printindex

\bibliography{lit}{}
\bibliographystyle{alpha}
\end{document}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 
