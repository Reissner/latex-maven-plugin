\RequirePackage[l2tabu, orthodox]{nag}
% blabla 
%\PassOptionsToPackage{dvipdfmx}{xcolor} %or dvipdfm 
%\PassOptionsToPackage{dvipdfmx}{graphicx} %or dvipdfm 
%\RequirePackage{lmodern} % does not work with htlatex
%\directlua{pdf.setminorversion(7)}
\documentclass[a4paper,12pt]{book}
\newif\iflatextortf% false for latex but set true for latex2rtf internally 

%\includeonly{manualC3usage}

% for buildParams to check empty: \ifdefempty
\usepackage{etoolbox}
% for buildParams: \verbdef 
\usepackage{newverbs}

\input{header.tex}
% how to number the glossary in the toc? seemingly a gap in tocbibind 
%\usepackage[nottoc, numindex, numbib]{tocbibind}

\input{headerManual.tex}
\input{buildParams.tex}

\ifpdf%
  \ifLuaTeX%
    % for lualatex
    \pdfvariable minorversion=7% chktex 1
    % omit CreationDate and ModDate keys.
    \pdfvariable suppressoptionalinfo 767% chktex 1
    % no adding to the trailer dictionary.
    \pdfvariable trailerid{}% chktex 1
    \pdfvariable suppressoptionalinfo -1% chktex 1
  \else
    \ifXeTeX%
      % for xelatex
      \special{pdf:minorversion 7}
      % TBD: find a way to express pdfinfoomitdate: necessary? 
      \special{pdf:trailerid []}
    \else
      \ifPDFTeX%
        \pdfminorversion=7         % for pdflatex
        % omit CreationDate and ModDate keys.
        % not before pdfTeX 3.14159265-2.6-1.40.17
        \pdfinfoomitdate=1                   % for pdflatex
        % no adding to the trailer dictionary.
        %\pdftrailer=0                        % for pdflatex
        \pdftrailerid{}                       % for pdflatex
        \pdfsuppressptexinfo=-1               % for pdflatex
      \else
        % Here, the tex processor is unknown. 
      \fi%pdftex
    \fi%xetex
  \fi%luatex



  % 1 -> PTEX.Fullbanner
  % 2 -> PTEX.FileName
  % 4 -> PTEX.PageNumber
  % 8 -> PTEX.InfoDict (/Producer /Creator /CreationDate /ModDate /Trapped)
  % The following is to control metadata: 
  % - erase docdata and set the ones needed thereafter
  % - erase trailer to make repreoducible 
  %   CAUTION: This is not recommended as the docs are no longer individual. 


  %\pdfinfo{
  %   /Author (Ernst Reissner)
  %   /Title  (Maven plugin and ant-task to process latex)
  %   /CreationDate (unknown)
  %   /ModDate (unknown)
  %   /Subject (latex plugin for maven and latex task for ant)
  %   /Keywords (svg;png;metapost;PDF;LaTeX;maven;ant)
  %}

   % TBD: check of resulting pdf with exif unveils a warning duplicate author 
\else%ifpdf
\fi%ifpdf


\hypersetup{
  pdfinfo={
    Author      ={Ernst Reissner},
    Title       ={Maven plugin and ant-task to process latex},
    CreationDate={unknown},
    ModDate     ={unknown},
    Producer    ={unknown},
    Subject     ={latex plugin for maven and latex task for ant},
    Keywords    ={svg;png;metapost;PDF;LaTeX;maven;ant}
  }
}


\IfPackageLoadedTF{tex4ht}{%
  % no glossaries and no index with tex4ht 
  \newcommand{\gls}[1]{#1}
  \renewcommand{\index}[1]{}
  \newcommand{\newindex}[1][]{}
}{%
\setacronymstyle{long-short}
% file formats 
\newacronym{pdf}{pdf}{portable document format}
\newacronym{dvi}{dvi}{device independent; 
traditional output format of tex processors, today widely replaced by PDF}
\newacronym{xdv}{xdv}{extended device independent; 
an extension of the traditional output format \gls{dvi} of tex processors, 
today widely replaced by PDF}
\newacronym{eps}{eps}{encapsulated postscript}
\newacronym{tex}{tex}{\TeX{} the format, which may also be latex}
\newacronym{html}{html}{HyperText Markup Language}
\newacronym{xhtml}{xhtml}{extensible hypertext markup language}
\newacronym{odt}{odt}{open document text}
\newacronym{doc}{doc}{outdated document format for MS Word }
\newacronym{docx}{docx}{current document format for MS Word }
\newacronym{sgml}{sgml}{Standard generalized markup language }
\newacronym{xml}{xml}{extensible markup language }
\newacronym{ptx}{ptx}{pdf/postscript \TeX{} format; home-brewed }% home-brewed 

\newacronym{fig}{fig}{native file format for xfig }
\newacronym{gp}{gp}{Gnuplot file format}
\newacronym{png}{png}{Portable Network Graphics}
\newacronym{jpg}{jpg}{Graphics format developed by the Joint Photographic Experts Group }
\newacronym{gif}{gif}{Graphics Interchange Format, allows also animations }
\newacronym{bb}{bb}{Bounding box, created by ebb }
\newacronym{xbb}{xbb}{Bounding box, created by ebb with the option x. 
In addition to bb-files contains a high resolution bounding box }
\newacronym{svg}{svg}{Scalable Vector Graphics}
% latex file endings 
\newacronym{toc}{toc}{table of contents: input and output format of tex processors}
\newacronym{lof}{lof}{list of figures: input and output format of tex processors}
\newacronym{lot}{lot}{list of tables: input and input and output format of tex processors}
\newacronym{lol}{lol}{list of listings: input and output format of tex processors 
if used with package \texttt{listings}}
\newacronym{bcf}{bcf}{bibliography content file (?): generated by tex processors 
if used with package \texttt{biblatex}}
\newacronym{out}{out}{contains bookmarks: input and output format of tex processors 
if used with package \texttt{hyperref}, file ending seems naive}
\newacronym{ist}{ist}{(make-)index style file: output format of tex processors % chktex 36
if used with package \texttt{glossaries} configured for \texttt{makeindex} }
\newacronym{xdy}{xdy}{index style file for \texttt{xindy}: output format of tex processors 
if used with package \texttt{glossaries} configured for \texttt{xindy} }


\newacronym{log}{log}{logging file: for tex processors and \texttt{mpost}}
\newacronym{aux}{aux}{auxiliary file: input and output file for tex processors; read also e.g\@. by \texttt{bibtex}}
\newacronym{fls}{fls}{files dependencies: list of files the according tex file depends on; 
output format of tex processors if used with option \texttt{-recorder}}
\newacronym{synctex.gz}{synctex.gz}{fgzipped synchronization files 
relating tex files and their according pdf files: 
output format of tex processors if used with option \texttt{-synchtex=1}}

% files in conjunction with bibliographies
\newacronym{bib}{bib}{bibliography file: 
In particular input file for the \texttt{bibtex} tool}
\newacronym{bbl}{bbl}{bibliography for a latex document in latex format: 
written by the \texttt{bibtex} tool and read by \LaTeX{} processors}

% files in conjunction with indices 
\newacronym{idx}{idx}{index file containing unsorted and multiple index entries; 
output format of tex processors with package \texttt{makeindex} or similar}
\newacronym{ind}{ind}{%
index file containing sorted, unified and formatted index entries, 
output format of \texttt{makeindex} and \texttt{xindy}}

% files in conjunction with glossaries 
\newacronym{glo}{glo}{%
glossary file containing unsorted and multiple glossary entries; 
output format of tex processors with package \texttt{makeglossaries}}
\newacronym{glg}{glg}{%
\texttt{makeglossaries} log file }
\newacronym{gls}{gls}{%
glossary file containing sorted, unified and formatted glossary entries;
output format of the \texttt{makeglossaries} tool read by tex processors}
% TBD: one could add is and xdy files. 

% files in conjunction with pythontex
\newacronym{pytxcode}{pytxcode}{%
Code file consisting mainly of code snippets from the tex file; 
output format of tex processors with package \texttt{pythontex}}
\newacronym{depytx}{depytxc}{%
File containing information to replace code snippets in the tex file 
by the result of their evaluation;  
output format of tex processors with package \texttt{pythontex} 
if loaded with option \texttt{depythontex}
}
\newacronym{plg}{plg}{%
\texttt{pythontex} log file: home brewed since the original application does not write log files 
}
\newacronym{dplg}{dplg}{%
\texttt{depythontex} log file: home brewed since the original application does not write log files 
}

\newacronym{mp}{mp}{metapost: input format for the graphic program \texttt{mpost}}
\newacronym{ps}{ps}{PostScript: 
programming language for printers and printable file format; 
today mostly replaced by PDF}
\newacronym{mps}{mps}{metapost's postscript like output including text}
\newacronym{mpx}{mpx}{metapost tex output: texts }
\newindex[General Index]{idx}
\newindex[LaTeX Packages]{pkg}
}

% \newglossaryentry{latex}{name={latex},description={%
% A document preparation system 
% converting sources in the latex-format preferrably into pdf-output. 
% Historically, output was in \gls{dvi}-format 
% which is still used by htlatex as an intermediate format 
% to produce \gls{html} resp.~\gls{xhtml} and \gls{odt} output. 
% }}
% \newglossaryentry{htlatex}{name={htlatex},description={%
% A script which wraps latex 
% but producing (x)html and odt output instead of pdf 
% which is usual for latex. 
% }}
%\newglossaryentry{ps}{name={PostScript},description={%
%A computer language for creating vector graphics. 
%}}

\usepackage[depythontex]{pythontex}% TBD: check whether appropriate 


\renewcommand{\lstlistoflistings}{\begingroup
\tocfile{\lstlistingname}{lol}
\endgroup}
%and to number the Listof heading do:
\renewcommand{\lstlistoflistings}{\begingroup
%\tocsection
%\tocchapter
\tocfile{List of \lstlistingname{}s}{lol}
\endgroup}


% \newindex[General Index]{idx}
% \newindex[LaTeX Packages]{pkg}

% does not work 
%\setindexpreamble[pkg]{This index comprises all the latex packages used. }

\title{Manual for the \artifactId{} \protect\\
  and for an according ant-task \protect\\
Version \strippedVersionID}
\author{Ernst Reissner (rei3ner@arcor.de)}
\date{\versionDate}


% seems to have a problem with pythontexW maybe clean before
%\includeonly{manualC4graphics}

\begin{document}
\maketitle

\tableofcontents
\listoffigures
\listoftables
\lstlistoflistings%


\include{manualC1intro}
\include{manualC2inst}
\include{manualC3usage}
\include{manualC4graphics}
\include{manualC5procMain}
\include{manualC6paramsSettings}
\include{manualC7ExcLogging}


\chapter{Gaps}\label{chap:gaps}

Only figures created with xfig and stored as files pdf and ptx 
may be integrated into a \LaTeX{} document. 
This could be extended to a broader variety of export file formats. 
The problem is, that fig-files to not contain information on the export
format. 
This has to be either given elsewhere in a config file 
or determined by pre-parsing the tex-files. 

There is no support for pictures in \gls{gif}-format 
but maybe a converter to \gls{png} is all needed. 

There is no proper make-mechanism taking dependencies into account. 
Thus all documents in all formats specified are remade, 
whether they changed or not. 

Also, if more than one target is created from one \LaTeX{} source, 
common steps are redone for each target. 
E.g.~if pdf and html are created, 
pdf creation is done twice and if pdf, html, odt and docx are created, 
odt is done twice (once for odt second for docx) 
and pdf is done even trice: 
once for pdf itself, once for odt and once for docx. 

% This has to be removed. 
Creating more than one index is supported only 
via package \pkg{splitidx} in conjunction with \texttt{SplitIndex}. 
There are the following packages also supporting multiple indices 
but not supported officially: 
\pkg{index} described in~\cite{IndexP}, 
\pkg{amsmidx} described in~\cite{AmsmidxP} and 
\pkg{imakeidx} described in~\cite{ImakeidxP}.
Note that the package \pkg{multind} is obsolete. 

According to~\cite{GloP}, Section~1, 
there are three options to create a glossary, 
whereas this software supports option two only, 
which uses \texttt{makeindex}. 
Also, although the package \pkg{glossaries} itself 
supports multiple glossaries via the command
%
\begin{lstlisting}[language=TeX, basicstyle=\small]
\newglossary[log-ext]{name}{in-ext}{out-ext}{title}[counter]
\end{lstlisting}
%
described in~\cite{GloP}, Section~12, 
this software only supports creating a single glossary. 

Reading~\cite{GloP}, Section~15.1, the glossarystyle \texttt{index} 
seems to allow creating indices through the \pkg{glossaries} package 
making any index-package obsolete. 

For development given the \LaTeX{} main file \texttt{xxx.tex}, 
the files \texttt{xxx.pdf}, \texttt{xxx.pdf}, \texttt{xxx.synctex.gz} 
and \texttt{xxx.log} are vital. 
Thus it would be fine to have a goal which touches these files 
or to have a parameter to touch these prior to creation 
to avoid that these are cleaned up after the run. 
This is an alternative to setting parameter \texttt{cleanup} to \texttt{false}. 
On the other hand, goal \texttt{grp} creating graphics 
in conjunction with a development tool like \auctex{} for \texttt{emacs}, 
allows to compile a latex main file in that tool 
and thus to access \texttt{xxx.log} and \texttt{xxx.pdf}. 

There are lots of possible improvements to be done on the goal \emph{check}. 


The ant-task does not allow creating single formats, e.g.~pdf selectively. 

The ant-build is not completed: tests are not run and 
test runs are no prerequisite for installation. 

This manual is not finished. 
To test the overall functionality of the maven-plugin and of the ant-task 
described here, this manual is created through plugin and task. 

Support for djvu via pdf2djvu: 
pdf2djvu -o output\_file input\_file

pdf2dsc
(ps with document structuring convention) 

pdf2svg is not so useful. 

pdftohtml -c is also not bad, 

consider also pdftocairo for creation of tiff and ps and many others. 

\chapter{Bugs}\label{chap:bugs}

Seemingly, indices and glossaries based on page numbers 
(there seems to be an alternative to this), 
may be out of date with the current algorithm: 
First \lualatex{} (or some other converter) is run to create the raw index. 
Then a sorting program like \texttt{makeindex} is called 
which creates the sorted, collected and formatted index. 
Then one \lualatex{} run is required to include this index 
into the created pdf-file. 
A second \lualatex{} run is required 
to write the index to the table of contents, as typically required. 
The problem with this procedure is, 
that the subsequent runs of \lualatex{} change the raw index 
which requires rerunning \texttt{makeindex} 
and after that again \lualatex. 

One way to solve that problem is to use the package \pkg{imakeidx} 
(improved makeidx) instead of the traditional package \pkg{makeidx}. 
This offers also multiple indices, which is another gap to be filled. 
Seemingly, \pkg{imakeidx} does not support glossaries 
and so for these, another solution is required, 
although the problem is the same. 

Packages \pkg{robustindex} and \pkg{robustglossaries} 
% **** reference? 
offer another solution. 
The advantage would be to have handled both index and glossary. 
Also support of hyperrefs within indices and glossaries seem to be expanded. 
On the other hand, the two packages seem experimental 
and seem to play with package \pkg{hyperref}. 

The current implementation is based on package \pkg{rerunfilecheck} 
which works for index but not for glossary. 

Check whether \pkg{glossaries} option \texttt{autorun} makes sense. 
Seems to run the command \texttt{makeglossaries} after each latex run. 
But how to find out whether to rerun latex??? 

Pattern to identify latex main file: 
Documentation: shall not include the environment 
\texttt{documentclass/documentstyle} in an input. 
Also check \texttt{RequiresPackage} 
and check whether \texttt{(re)newcommand} is possible % chktex 36
or makes sense. 

Maybe there is a bug in the number of reruns: 
I think, makeglossaries is like bibtex needing two latex reruns 
and not like makeindex, which requires a single rerun. 

Since this software heavily relies on \pkg{rerunfilecheck}, 
maybe a warning if not used is a good idea. 

Figures are missing in html output 
Formulae are missing in html output. 
Index is s missing in html output. 
Glossary occurs in the toc but is not numbered. 

Did not find a way to add a numbered entry for the glossary 
into the table of contents. 

The pattern \texttt{(!\ )} detects an error only % chktex 37
\texttt{-no-file-line-error} (which is the default) is set 
but does not work with option \texttt{-file-line-error}. 
This yields 
%
\begin{verbatim}
./manualLMP.tex:2500: Undefined control sequence.
l.2500 \bla
\end{verbatim}
%
instead of 
%
\begin{verbatim}
! Undefined control sequence.
l.2500 \bla
\end{verbatim}

I ask myself how to detect this error in file line error mode! 

%\bla

Pattern matching is line-wise. 
This is inappropriate for patternLatexMainFile 
but also for further patterns like multiline-warnings. 

Also there seems to be a bug in java's regex package, 
which leads to non-termination: 
pattern \texttt{\~(\textbackslash s*)*xx} seems not to terminate. % chktex 1

A problem is also that the ending ``\texttt{.svg}'' may occur as a source 
and as a target file of htlatex. 
Thus \texttt{mvn latex:clr} tries to delete the targets of the svg-files, 
although these are not sources but themselves targets. 

A way to solve this problem is, 
to apply the delete pattern to graphic source files 
and the files created. 
CAUTION\@: for svg, 
the files created by the latex run shall be taken into account. 
A warning shall be issued for each matching. 


Target html: references to figures are missing. 
jpg and png-pictures oddly represented. 
With option svg: problem. 
Leave away, then at least the formula occurs. 
But then, from the mixed pictures only the text occur, 
whereas the pdf is still missing. 
Maybe htlatex still relies on eps-format. 
Table is very wide. 
Umlauts and sz maybe also not properly represented. 

Still for target html: currently all aspects making problems 
are deactivated: 
Figures, index and glossary. 
For the index have a look at the log-file. 
These aspects must be re-integrated as soon as possible. 

For html: run package tex4ht with option \texttt{info} 
to obtain further options and their descriptions. 
Also add a proper description into this manual. 

For files \texttt{.directory} (``\texttt{.}'' first), 
the separation of root and suffix does not work. 
Maybe the best to ignore files like that. 

Target \texttt{txt}: seems as if index and glossary not up to date. 

target \texttt{pdf}: Idea to run \texttt{makeglossaries} 
always prior to \lualatex. 

Maybe this is more a gap than a bug: 
support for dvi-creation should be provided separately. 

For target dvi, 
neither png nor jpg-pictures are included. 
The other formats work with \texttt{\$pdfViaDvi} set. 
Note that the postscript-files must be in the same directory 
as the dvi, probably because it includes them 
only by link. 

For the other case, \texttt{\$pdfViaDvi} unset, this requires some research. 

Also for creation of the txt-format, 
\texttt{\$pdfViaDvi} must be set. 

FIXME\@: on bibliography, index and glossary 

The application \texttt{chktex} does not necessarily return an error code 
if something goes wrong, e.g.~reading \texttt{-l chktexrc}. 
Thus only in debug mode one can recognize the misbehavior. 
This knocks out detection of build failures. 

Also I would like to replace the global \texttt{chktexrc} by a local version, 
via `\texttt{-g0 -l chktexrc.my}'. 
The problem is, 
that the file is interpreted relative to the working directory. 

The application chktex has an option \texttt{-I} to specify, 
whether input files shall be read. 
If not, creation of graphics is immaterial. 
I can also imagine, that one wants to configure, 
whether graphics shall be created or not. 

It may make sense to define in \texttt{chktexrc} another verbosity level 
with format allowing to decide whether there is a warning/error/message. 
Now I modified the levels that all but the headlines start with blank. 
This makes it easy in -v1 and in -v2 to detect warning/error/message 
at the beginning of a line, 
without the risk of false error because a message is logged 
on a text starting with the word ``error''. 


Maybe this is not a bug 
but an inconsistency between \auctex{} and local config: 
Running with the plugin, e.g.~with \pdflatex, we obtain 
%
\begin{Verbatim}[fontsize=\tiny]
This is pdfTeX, Version 3.14159265-2.6-1.40.15 (TeX Live 2014) (preloaded format=pdflatex 2014.8.9)  30 JAN 2017 10:58
entering extended mode
 \write18 enabled.
 Source specials enabled.
 %&-line parsing enabled.
**test.tex
(./test.tex
\end{Verbatim}
%
whereas running from within Emacs with \auctex{} we obtain 
%
\begin{Verbatim}[fontsize=\tiny]
This is pdfTeX, Version 3.14159265-2.6-1.40.15 (TeX Live 2014) (preloaded format=pdflatex)
 restricted \write18 enabled.
entering extended mode
\end{Verbatim}
%
and also the behavior is slightly different, 
e.g.~on file 
% TBD: clarify why this does not work with lstlisting...
\begin{verbatim}
\documentclass{article}
\begin{document}
 äö¿
\end{document}
\end{verbatim}

The parameter \texttt{patternReRunLatex} 
treated in Section~\ref{subsec:patternReRunLatex} 
needs more careful investigation. 
This is done to some extent in class \texttt{org.m2latex.core.Settings}.  


\chapter{Preferred usage, Test Concepts and Tests}\label{chap:tests}

This software may be used in different environments, 
is highly configurable and 
also there is a huge amount of packages potentially in use. 

In order not to get lost in extensive tests for covering all and everything, 
the author applies the notion of\index{preferred usage} \emph{preferred usage}. 
This is essentially the way the author uses this software. 
This is also what is tested extensively. 
Other ways of usage are supported insofar as reported bugs are fixed in general, 
but since explicit tests lack, the quality is lower for these cases. 

The preferred usage is defined as follows: 
%
\begin{itemize}
  \item Linux, to be more precise, SuSE tumbleweed. 
  The author used this software frequently and always with success on Windows also. 
  As a shell use git shell. 
  \item \LaTeX{} Distribution \texlive, to be more precise the SuSE specific variant. 
  In the long run \miktex{} must be at least tried also. 
  As \miktex{} is available for Linux also, test will be under Linux. 
  \item 
  VS Code with the extensions installed by \texttt{instVScode4tex.sh} 
  which is described in Section~\ref{subsec:instExtVsCode}, 
  and the viewer \texttt{okular}. 
  This is defined here, although not going into the artifacts. 
  \item The VS Code extension \texttt{james-yu.latex-workshop}, 
  which is installed by \texttt{instVScode4tex.sh} is used only with build recipe 
  \texttt{latexmk (latexmkrc)}. 
  \item If \texttt{latexmk} is used, then with config file \texttt{.latexmkrc}, 
  whereas \texttt{chktex} is definitely used, 
  and it is configured with config file \texttt{.chktexrc}. 
  Both config files are injected by \texttt{inj} described in Section~\ref{sec:injFiles}. 
  \item Neither \texttt{latexmk} nor \texttt{chktex} is used with options. 
  \item The maven plugin, rather than the ant task. 
  \item Configuration is the default setting of this plugin. 
  In particular, the latex processor is \lualatex. 
  \item Document classes are \texttt{book}, \texttt{article} and \texttt{beamer}. 
  For beamer documents, preferred usage are both, the presentation and the handout 
  as described in Section~\ref{subsec:sourcesLatex}. 
  Note that, unlike most other aspects of preferred usage, 
  this is not tested through this manual 
  but with the beamer presentation and handout given by~\cite{PresBeamer}. 
  \item \LaTeX{} packages are those given by \texttt{header.tex} 
  described in Section~\ref{sec:injFiles}. 
  \item Graphics are in the formats described and used in the manual. 
  \item Using tools pythontex, makeindex, splitindex, makeglossaries 
  belongs to the preferred usage. 
  This does not mean that these tools must be used, 
  but it means that the usage is restricted to these tools, not taking graphics into account. 
  \item Tools must be used with accepted version, 
  in the sense that \texttt{mvn latex:vrs} does not emit a warning. 
  \item The output format is PDF\@. 
\end{itemize}


It is the ``founded conviction'' of the author, that in most of the use cases, 
restriction to the preferred usage is possible 
but when deviating, there is some increased risk 
that there is a bug in this \LaTeX{} builder. 

The set of documents coming with this software 
are compiled sticking to the preferred usage. 
Above all, this manual~\cite{LatexPlugin} not only describes all vital features, 
but also uses them, with one big exception: Its document class is \texttt{book}, 
and it cannot have other document classes of course. 
Most other documents are \texttt{article}s 
and~\cite{PresBeamer} refers to a presentation with class \texttt{beamer} 
and to the according handout which is again an article. 
So the build process for these documents altogether 
cover the preferred usage to a wide extent. 
Thus, a bug in this \LaTeX{} builder 
is likely to be reflected in a deficiency 
in the compiled version of one of these documents. 

This shows that testing the compiled documents is a reasonable test strategy. 
It is not feasible to do this manually for whole documents, 
and it is also technically close to impossible to do it automatically. 
What can be checked automatically is coincidence with the last document. 


So the strategy is to either change the (source of the) software 
or the \emph{source of the} documents, but never both at once. 
If the software is changed, the created documents must persist. 
Changes in the manual are locally in the sources 
and result in local changes in the compiled document, 
because the software was not changed. 
Thus, the compiled document can be checked manually. 
Since the only output format being part of the preferred usage is PDF, 
only compilations into PDF must be taken into account. 

Section~\ref{sec:chkReprod} describes how this \LaTeX{} builder 
can perform an equality check on PDF documents. 
There, both Section~\ref{sec:paramRepro} on parameters for equality check is referenced 
and Table~\ref{tab:TLP} comprising build failures if the documents do not coincide. 
We highlight the parameter \texttt{chkDiff} which determines whether the check is performed 
and build failures \texttt{TLP01} thrown if the documents differ. 
In tests, \texttt{chkDiff} is set \texttt{true}, the default is \texttt{false}. 
\medskip


Although this test concept seems appealing, 
it is not always easy to realize. 

Before explaining the difficulties, let us differentiate between the two ways 
the pom of this plugin uses this plugin itself. 
The pom for performing tests 
is based on \href{\urlSite fromMain/pom4pdf.xml}{pom4pdf.xml}, 
not on the actual \texttt{pom.xml} of the project 
a version of which is 
\href{https://github.com/Reissner/latex-maven-plugin/tree/master/maven-latex-plugin}%
{on github}. 
For \texttt{pom4pdf.xml}, the current version is determined by filtering, 
which remains correct even during the release process. 
In addition, the project \texttt{pom.xml} used for development 
contains another, explicit dependency to \texttt{latex-maven-plugin}. 
This one is used for creating the documents for the site 
and also for developer tests. 
Thus, during development \texttt{pom.xml} is kept close to \texttt{pom4pdf.xml}, 
and it has a snapshot version \texttt{x.y.0-SNAPSHOT}. 

Let us first consider the case of development 
in which the version of this plugin is a SNAPSHOT version. 
Then tests refer to the (snapshot) version under consideration. 
If a change is made to the documents and all tests pass, 
the changed documents are compiled with current software, 
and go into the next snapshot deployed. 
To be precise, the documents are compiled with deployed software, 
which is equivalent with the software compiled from the current sources. 

If in contrast the software is changed, keeping the manual unchanged, 
then still compilation of the documents and also check 
is performed with the deployed version of this \texttt{latex-maven-plugin}. 
So, to decide whether the documents remain the same after the software change, 
a second build must be performed, 
because this compiles with the newly deployed snapshot of this software. 



The situation is even more complicated 
if development is finished for the current version 
and a new release must be built. 
As is state of the art, 
for this task the \texttt{maven-release-plugin} is used. 
It requires for sake of reproducibility, 
that the pom of the project, not the pom  has dependencies and plugins only in release versions, 
no snapshot versions. 

As is state of the art, 
for release the \texttt{maven-release-plugin} is used. 
Whereas it has no explicit restrictions on the pom for tests \texttt{pom4pdf.xml}, 
it requires for sake of reproducibility, 
that the pom of the project \texttt{pom.xml} has dependencies and plugins 
only in release versions, no snapshot versions. 
This applies also to this plugin. 
For development, it has version \texttt{x.y.0-SNAPSHOT} 
to deploy \texttt{x.y.0}, and this is also the version one wants to create a site with, 
but this is the one to released at present. 
A possible fallback is always to deactivate the usage of this plugin. 
As a consequence, later a version \texttt{x.y.1} shall be released, 
which uses \texttt{x.y.0} for site creation. 
Better is to use the last release version and to configure it so 
that the documents can be compiled with the old version. 
This may require a creative release planning, including features used to compile documentation 
and maybe a change in the parameters or some other change in the environment, 
which must be compensated in later releases also. 

Let us give examples of creative realizations of the described test concept 
relying on thorough release planning. 
To release \texttt{2.0.0} starting with the prior version \texttt{1.8.0}, 
almost only injections are added. 
These can be done manually using \texttt{2.0.0-SNAPSHOT}. 
Then the injected files are checked in into version control 
and then the documentation can be compiled with old version \texttt{1.8.0} 
with the same result. 
In a release \texttt{2.0.1}, version \texttt{1.8.0} can be replaced by \texttt{2.0.0}. 

For version \texttt{2.1.0} it is planned, that this plugin can use \texttt{latexmk}, 
and in the manual this is also described. 
In \texttt{2.1.0-SNAPSHOT} the manual may be compiled using \texttt{latexmk}, 
but nevertheless, in \texttt{2.1.0} the manual is still compiled without \texttt{latexmk}, 
using release \texttt{2.0.0} for creating the manual for the site. 
Only in \texttt{2.1.1}, also the manual is included in the site using \texttt{latexmk}. 

For version \texttt{2.2.0} it is planned, to support \texttt{bib2gls} directly. 
Observe that \texttt{2.1.0} supports can treat \texttt{bib2gls} via \texttt{latexmk}, 
but without all the monitoring \texttt{2.2.0} offers with direct support. 
Of course, the manual describes direct support and 
some \texttt{2.2.0-SNAPSHOT} is able to compile the manual using \texttt{bib2gls} directly. 
Nevertheless, close to release for site creation, 
\texttt{2.1.0} is used again relying on \texttt{latexmk} to invoke \texttt{bib2gls}. 
In \texttt{2.2.1} then \texttt{2.2.0} can be used for site creation invoking \texttt{bib2gls} directly. 


Note that the test concept based on preferred usage has a considerable weakness: 
It cannot test warnings, errors and exceptions 
because they are not preferred usage. 
On the other hand, it is an important design goal, 
that the result of this software is trustable if no warning, error or exception occurs. 
This requires extensive tests also on imperfect runs. 
These must be supplemented in future. 

FIXME\@: this chapter describes the tests to be performed. 

Missing are tests on logging, tests on various input formats, 
output formats, tests including several paths 
defined by invocation of auxiliary applications for index, glossary, \dots 

\bibliographystyle{alpha}
\bibliography{lit}{}

\IfPackageLoadedTF{tex4ht}{%
  % no index and no glossaries with tex4ht 
}{
%\chapter{Indices}
  \printindex[idx]
  \printindex[pkg]
  %\printglossaries%
}


%  "-src-specials -shell-escape -recorder" 
\end{document}

