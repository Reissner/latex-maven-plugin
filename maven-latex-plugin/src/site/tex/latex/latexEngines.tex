%\DocumentMetadata{uncompress}%pdfversion=1.7,
\RequirePackage[l2tabu, orthodox]{nag}
\documentclass[a4paper]{article}%scrartcl [12pt, a4paper]
%\pdfvariable compresslevel 0
%\pdfcompresslevel 0
%\pdfobjcompresslevel 0
% \usepackage{iftex}
% \usepackage{longtable}
% \usepackage{booktabs}
% \usepackage{xurl}
%\special{dvipdfmx:config z 0}
% \special{pdf:trailerid [
%   <00112233445566778899aabbccddeeff>
%   <00112233445566778899aabbccddeeff>
% ]}
\input{../header.tex}
\input{../headerSuppressMetaPDF.tex}

\hypersetup{
  pdfinfo={
    Author      ={Ernst Reissner},
    Title       ={Special and common aspects of pdf/dvi/xdvi generators },
    % Creator     ={unknown}, 
    % % LaTeX with hyperref; this is uniform for hyperref. 
    % % except for beamer class, then it is LaTeX with Beamer class
    % % else TeX for lua/pdflatex, but  XeTeX output 2023.12.06:0106 for xelatex 
    % % thus it is advisable to eliminate this 
    % % maybe security issue, but it is well visible. 
    % % also corrupts reproducibility. 
    % Producer    ={unknown},
    % % xdvipdfmx with version and that like for dvi or xelatex; 
    % % pdfTeX-1.40.25, LuaTeX-1.17.0 for pdf
    % % This shall be eliminated. 
    % CreationDate={unknown},
    % ModDate     ={unknown},
    % % these two are only overwritten to avoid wrong entry 
    % % when using \texttt{SOURCE\_DATE\_EPOCH=0 FORCE\_SOURCE\_DATE=1}
    % % This is recommended for tests, because else we cannot give a \date 
    Subject     ={pdf/dvi/xdvi generators},
    Keywords    ={LaTeX;pdflatex;xelatex;lualatex}
  }
}

\title{Special and common aspects of pdf/dvi/xdvi generators }
\author{Ernst Reissner (rei3ner@arcor.de)}
\date{}%{\today}

\newcommand{\pdflatex}{\texttt{pdflatex}}
\newcommand{\lualatex}{\texttt{lualatex}}
\newcommand{\xelatex}{\texttt{xelatex}}

\newcommand{\cmd}[1]{\texttt{\textbackslash#1}}


\newcommand{\texlive}{\TeX~Live}
\newcommand{\miktex}{MiKTeX}

\begin{document}

\maketitle
\tableofcontents
%\listoffigures
\listoftables
%\lstlistoflistings%

\section{Introduction}

This document is created with \lualatex{} or that like 
with output format 
\ifpdf%
PDF%
\else
DVI% TBD: take XDV into account also 
\fi.
The package \texttt{tex4ht} 
is \IfPackageLoadedTF{tex4ht}{}{not} loaded. 

This document is about features the three generators on latex, 
\pdflatex, \lualatex{} and \xelatex{} have in common 
and discusses also aspects under which they are specific. 
These programs are just underlying tex engines preloading the the \LaTeX{} format. 
The names of the underlying engines just drop the inner sylable ``\texttt{la}''. 
For \texttt{pdftex} there is a user manual~\cite{PdfTexUsr}, 
for \texttt{luatex} there is a reference manual~\cite{LuaTexRef} and 
for \texttt{xetex} a reference guide~\cite{XeTexRef}. 

The first aspect we cover are the options (among those to display the version). 
It turns out, that the options are specific for the distribution. 
Apart from \texlive{}, there is a second important distribution, \miktex, 
which should also be treated. 

We treat the options for \texlive{} in Section~\ref{sec:optionsTexlive} 
and for \miktex{} in Section~\ref{sec:optionsMiktex}. 

The second subject is treatment of metadata available for PDF files. 
The motivation here is privacy as part of security 
and creation of reproducible documents, e.g. for tests. 
The results of our research is collected in Section~\ref{sec:metaPDF}. 

\section{The options for \texlive}\label{sec:optionsTexlive}


Note that in fact we use a variant of \texttt{luatex}, called \texttt{luahbtex}. 

This document is valid for versions of the underlying tex engine 
as given in Table~\ref{tab:versions}. 
Moreover, our research refers to a specific distribution, \texlive. 


\begin{longtable}{|ll|}
  \toprule
  converter & version \\
  \midrule
  \midrule
  \endfirsthead%
  \bottomrule
  \caption{\label{tab:versions} Converters and the version this document refers to }
  \endlastfoot%
  \pdflatex{}  & \texttt{pdfTeX 3.141592653-2.6-1.40.24} \\% chktex 8
  \xelatex{}   & \texttt{XeTeX 3.141592653-2.6-0.999994} \\% chktex 8
  \lualatex{}  & \texttt{LuaHBTeX, Version 1.15.0} \\
\end{longtable}


We start with a synopsis of the options. 
Table~\ref{tab:latexOptionsCommonTexlive} 
shows options of the converters under consideration. 
Note that in contrast to the other converters, 
\lualatex{} defines options starting with \texttt{-{}-} 
but it can also process the options if given with a single dash also. 
Conversely, converters other than \lualatex{} can also deal with options 
starting with single dash. 
Options unknown to a converter never result in an error or even a warning; 
instead just a info message is displayed. 
This allows to create a configuration which works for all converters. 

In Table~\ref{tab:latexOptionsCommonTexlive} column ``included'', 
each converter is represented by the starting letter of its name, 
so for each option it is known which converters know about it 
an conversely, which options each converter has. 

The table allows to furnish configurations working for all converters. 
Some options are common to all converters


{\footnotesize
\begin{longtable}{|lllll|}
\toprule
option & \multicolumn{3}{l}{included} & explanation \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:latexOptionsCommonTexlive} Options of \TeX{} engines in \texlive}
\endlastfoot%
\texttt{(-)-cnf-line=STRING}       & p&x&l & parse \texttt{STRING} as a configuration file line \\
\texttt{-{}-credits}               & -&-&l & Display credits and exit. \\
\texttt{-{}-debug-format}          & -&-&l & enable format debugging \\
\texttt{(-)-draftmode}             & p&-&l & switch on draft mode (generates no output PDF) \\
\texttt{-enc}                      & p&-&- & Enable encTeX extensions such as \texttt{\textbackslash{}mubyte} \\
\texttt{-etex}                     & p&x&- & enable e-TeX extensions \\
\texttt{(-)-[no-]file-line-error}  & p&x&l & disable/enable file:line:error style messages \\
\texttt{-{}-[no-]file-line-error-style} & -&-&l& aliases of \texttt{-{}-[no-]file-line-error} \\
\texttt{-fmt=FMTNAME}              & p&x&l & use FMTNAME instead of program name or a \%\& line\footnote%
{in fact for \lualatex{} the explanation deviates a bit: \texttt%
{-{}-fmt=FORMAT\@: load the format file FORMAT}} \\
\texttt{(-)-ini}                   & p&x&l & for dumping formats \\
\texttt{-ipc}                      & p&-&- & send DVI output to a socket \\
                                   &  & &  & as well as the usual output file \\
\texttt{-ipc-start}                & p&-&- & as \texttt{-ipc}, and also start the server at the other end \\
\texttt{(-)-halt-on-error}         & p&x&l & stop processing at the first error \\
\texttt{(-)-help}                  & p&x&l & display this help and exit \\
\texttt{(-)-version}               & p&x&l & output version information and exit \\
\texttt{-8bit}                     & p&x&- & make all characters printable by default\footnote%
{for \xelatex: don't use \^{}\^{}X sequences} \\
\texttt{(-)-interaction=STRING}    & p&x&l & set interaction mode \\
                                   &  & &  & (\texttt{STRING=batchmode/nonstopmode/} \\
                                   &  & &  &  \texttt{scrollmode/errorstopmode}) \\
\texttt{(-)-jobname=STRING}        & p&x&l & set the job name to \texttt{STRING} \\
\texttt{(-)-kpathsea-debug=NUMBER} & p&x&l & set path searching debugging flags \\
                                   &  & &  & according to the bits of \texttt{NUMBER} \\
\texttt{-{}-lua=FILE}              & -&-&l & Load and execute a lua initialization script. \\
\texttt{-{}-luaonly}               & -&-&l & run a lua file, then exit \\
\texttt{-{}-luaconly}              & -&-&l & byte-compile a lua file, then exit \\
\texttt{-{}-luahashchars}          & -&-&l & the bits used by current Lua interpreter for strings hashing \\
 \texttt{(-)-[no-]mktex=FMT}       & p&x&l & disable/enable mktexFMT generation\footnote%
{\texttt{(FMT=tex/tfm/pk)} for \pdflatex; else \texttt{(FMT=tex/tfm)}} \\
\texttt{-mltex}                    & p&x&- & enable MLTeX extensions such as \texttt{\textbackslash{}charsubdef} \\
\texttt{-no-pdf}                   & -&x&- & generate XDV (extended DVI) output rather than PDF \\
\texttt{-{}-nosocket}              & -&-&l & Disable the Lua socket library. \\
\texttt{(-)-output-comment=STRING} & p&x&l & use STRING for DVI file comment instead of date \\
                                   &  & &  & (no effect for PDF)\footnote%
{For \xelatex{} it is XDV instead of DVI and the remark \texttt{(no effect for PDF)} is missing} \\
\texttt{(-)-output-directory=DIR}  & p&x&l & use existing DIR as the directory to write files in \\
\texttt{(-)-output-format=FORMAT}  & p&-&l & use \texttt{FORMAT} for job output; \texttt{FORMAT} is `dvi' or `pdf'\footnote%
{\xelatex{} offers option \texttt{-no-pdf} instead. } \\
\texttt{-output-driver=CMD}        & -&x&- & use \texttt{CMD} as the XDV-to-PDF driver instead of \texttt{xdvipdfmx} \\
\texttt{-papersize=STRING}         & -&x&- & set PDF media size to \texttt{STRING} \\        
\texttt{-[no-]parse-first-line}    & p&x&- & disable/enable parsing of first line of input file \\
\texttt{(-)-progname=STRING}       & p&x&l & set program (and fmt) name to \texttt{STRING}\footnote%
{\lualatex{} does not mention \texttt{(and fmt)}} \\
\texttt{(-)-recorder}              & p&x&l & enable filename recorder \\
\texttt{-{}-safer}                 & -&-&l & Disable easily exploitable Lua commands. \\
\texttt{(-)-[no-]shell-escape}     & p&x&l & disable/enable \texttt{\textbackslash{}write18{SHELL COMMAND}}\footnote%
{For \lualatex{} the explanation is \texttt{disable/enable system commands}} \\
\texttt{(-)-shell-restricted}      & p&x&l & enable restricted \texttt{\textbackslash{}write18}\footnote%
{For \lualatex{} the explanation is \texttt{restrict system commands to a list of commands given in texmf.cnf}} \\
\texttt{-src-specials}             & p&x&- & insert source specials into the DVI file \\
\texttt{-src-specials=WHERE}       & p&x&- & insert source specials in certain places of \\
                                   &  & &  & the DVI/XDV\footnote{DVI for \pdflatex; XDV for \xelatex} file. \\
\texttt{(-)-synctex=NUMBER}        & p&x&l & generate SyncTeX data for previewers\footnote%
{Explanation differs for \lualatex} \\ 
\texttt{-translate-file=TCXNAME}   & p& &  & use the TCX file \texttt{TCXNAME}\footnote%
{TCX means \TeX{} character translation} \\
\texttt{-{}-utc}                   &  & &l & Init time to UTC \\
\end{longtable}
} %\small





pdflatex: 

\begin{verbatim}
Usage: pdftex [OPTION]... [TEXNAME[.tex]] [COMMANDS]
   or: pdftex [OPTION]... \FIRST-LINE
   or: pdftex [OPTION]... &FMT ARGS
  Run pdfTeX on TEXNAME, usually creating TEXNAME.pdf.
  Any remaining COMMANDS are processed as pdfTeX input, after TEXNAME is read.
  If the first line of TEXNAME is %&FMT, and FMT is an existing .fmt file,
  use it.  Else use `NAME.fmt', where NAME is the program invocation name,
  most commonly `pdftex'.

  Alternatively, if the first non-option argument begins with a backslash,
  interpret all non-option arguments as a line of pdfTeX input.

  Alternatively, if the first non-option argument begins with a &, the
  next word is taken as the FMT to read, overriding all else.  Any
  remaining arguments are processed as above.

  If no arguments or options are specified, prompt for input.
\end{verbatim}





\section{The options for \miktex}\label{sec:optionsMiktex}

Since at the time of this writing, the author has no \miktex{} at hand, 
the results for \miktex{} are based on documentation, rather than experimentation. 
The three engines are a bit different, also in their names. 


Well this section is preliminary only. 
It turned out that Section~\ref{sec:optionsTexlive} is valid only for distribution \texlive. 
So in this section we venture to find out the options for the other big distribution, 
\miktex. 
We shall also investigate whether there are further distributions. 

Whereas the description~\cite{Texlive} seems not to mention the options explicitly, 
the \miktex{} manual~\cite{MiKTeX} describes each program in Section II, 6, 
in particular also the tex converters. 
This is the source of the following tables. 


The first observation is that, for \miktex{} all options start with two dashes, 
whereas for \texlive{} this is the case only for luatex. 
One has to clarify, whether the maven latex plugin under consideration really works for \miktex. 

{\footnotesize
\begin{longtable}{|lllll|}
  \toprule
  option & \multicolumn{3}{l}{included} & explanation \\
  \midrule
  \midrule
  \endfirsthead%
  \bottomrule
  \caption{\label{tab:latexOptionsCommonMiktex} Options of \TeX{} engines in \miktex}
  \endlastfoot%
  \texttt{-{}-alias=name}             & p&x&l       & Pretend to be program name, \dots\footnote%
 {Using this option is equivalent to copying the program file to name and invoking name.} \\
\texttt{-{}-aux-directory=dir}        & p&x&l       & 
Set \texttt{dir} as the directory to write auxiliary files to. \\
\texttt{-{}-buf-size=n}               & p&x&- & Set the the maximum number of characters \dots \\
\texttt{-{}-c-style-errors}           & p&x&l       & Change the way, error messages are printed. \\
\texttt{-{}-credits}                  & -&-&l & Display credits and exit\footnote%
   {The same as for \texlive. }. \\
\texttt{-{}-disable-8bit-chars}       & p&x&- & Make only 7-bit characters printable. \\
\texttt{-{}-disable/enable-installer} & p&x&l       & Disable/Enable automatic installation of packages. \\
\texttt{-{}-disable-write18}          & p&x&l       & Disable the \texttt{\textbackslash{}write18\{command\}} construct.\\
\texttt{-{}-enable-write18}           & p&x&l       & Fully enable the \texttt{\textbackslash{}write18\{command\}} construct\footnote%
{Corresponds roughly to \texttt{(-)-shell-escape} in \texlive. }. \\
\texttt{-{}-restrict-write18}         & p&x&l       & Partially enable the \texttt{\textbackslash{}write18{command}} construct. \\
%\texttt{-{}-parse-first-line}   & p&x&- & Disable checking \dots the first line \dots \\
\texttt{-{}-debug-format}             & -&-&l & Enable format debugging\footnote%
{The same as for \texlive. }. \\
\texttt{-{}-[dont-]parse-first-line}  & p&x&- & [Dont p|P]arse first line of input file \\
                                      &  & &        & under definite conditions\footnote%
{Similar for \texlive. Note that there is also a converse option. } \\
\texttt{-{}-draftmode}                & p&-&l  & switch on draft mode (generates no output PDF)\footnote%
{Some differences in formulation between the converter and also between distributions} \\
\texttt{-{}-enable-8bit-chars}        & p&x&- & Make all characters printable. \\
\texttt{-{}-enable-enctex}            & p&-&- & Enable encTeX extensions such as \texttt{\textbackslash{}mubyte}\footnote%
{Corresponds with \texttt{-enc} in \texlive. }. \\
\texttt{-{}-enable-etex}              & p&x&- & Enable eTeX extensions. \\
\texttt{-{}-enable-installer}        & p&x&l       & Enable automatic installation of packages. \\
\texttt{-{}-enable-mltex}             & p&x&- & Enable MLTeX extensions such as \texttt{\textbackslash{}charsubdef}. \\
\texttt{-{}-error-line=n}             & p&x&- & Set the width of context lines on \dots error messages. \\
\texttt{-{}-extra-mem-bot=n}          & p&x&- & Set the extra size \dots{} for large data structures \dots \\
\texttt{-{}-extra-mem-top=n}          & p&x&- & Set the extra size (in memory words) for chars, tokens, \dots. \\
\texttt{-{}-font-max=n}               & p&x&- & Set the maximum internal font number. \\
\texttt{-{}-font-mem-size=n}          & p&x&- & Set the size, in TeX memory words, of the font memory. \\
\texttt{-{}-half-error-line=n}        & p&x&- & Set the width of first lines of contexts \\
                                      &  & &        & in terminal error messages. \\
\texttt{-{}-halt-on-error}            & p&x&l       & Quit after the first error. \\
\texttt{-{}-hash-extra=n}             & p&x&- & Set the extra space for the hash table of control sequences \dots \\
\texttt{-{}-help}                     & p&x&l       & Give help and exitt\footnote%
{The same as for \texlive. }.. \\
\texttt{-{}-hhelp}                   & p&x&- & manual page in an HTML Help window\footnote%
{This option is only available on Windows systems.} \\
\texttt{-{}-include-directory=dir}    & p&x&l       & Add the directory \texttt{dir} to [those] \\
                                      &  & &        & to be searched for input files. \\
\texttt{-{}-initialize}               & p&x&l       & Become the INI variant of the program. \\
\texttt{-{}-interaction=mode}         & p&x&l       & Set the interaction mode (\texttt{mode=batchmode/nonstopmode/}\\
&& && \texttt{scrollmode/errorstopmode}). \\
\texttt{-{}-job-name=name}            & p&x&l       & Set the name of the job (\texttt{\textbackslash{}jobname}). \\
\texttt{-{}-job-time=file}            & p&x&- & Set the time-stamp of all output files \\
                                      &  & &        & equal to file's time-stamp. \\
\texttt{-{}-lua=FILE}                 & -&-&l & load and execute a lua initialization script\footnote%
   {The same as for \texlive. }.   \\
\texttt{-{}-luaonly}                  & -&-&l & Start LuaTeX as a Lua interpreter\footnote%
   {Could be the same as for \texlive. }.  \\
\texttt{-{}-luaconly}                 & -&-&l & byte-compile a lua file, then exit\footnote%
   {Could be the same as for \texlive. }. \\
\texttt{-{}-luahashchars}             & -&-&l & the bits used by current Lua interpreter for strings hashing \\
\texttt{-{}-main-memory=n}            & p&x&- & Change the total size \dots{} of the main memory array. \\
\texttt{-{}-max-in-open=n}            & p&x&- & Set the maximum number of input files \dots \\
\texttt{-{}-max-print-line=n}         & p&x&- & Set the width of longest text lines output. \\
\texttt{-{}-max-strings=n}            & p&x&- & Set the maximum number of strings. \\
\texttt{-{}-[no-]mktex=fmt}           & -&-&l & Enable/Disable \texttt{fmt} generation, \\
                                      &  & &  & where \texttt{fmt} must be either \texttt{tex} or \texttt{tfm}. \\
\texttt{-{}-nest-size=n}              & p&x&- & Set the maximum number of semantic levels \\
                                      &  & &        & simultaneously active. \\
\texttt{-{}-no-c-style-errors}        & p&x&l       & Don't change the way, error messages are printed. \\
\texttt{-{}-no-pdf}                   & -&x&- & generate XDV (extended DVI) output rather than PDF \\
\texttt{-{}-nosocket}                 & -&-&l & Disable the Lua socket library. \\
\texttt{-{}-output-comment=string}    & -&-&l & Use \texttt{string} for DVI file comment instead of date. \\
\texttt{-{}-output-directory=dir}     & p&x&l       & Write output files in \texttt{dir}\footnote%
{Similar as for \texlive. }. \\
\texttt{-{}-output-driver=CMD}        & -&x&- & use CMD as the XDV-to-PDF driver instead of xdvipdfmx \\
\texttt{-{}-output-format=format}     & p&-&l  & Use format for job output (one of: dvi, pdf)\footnote%
{\pdflatex{} and \lualatex{} differ a bit in text. Seems similar to \texlive. }. \\
\texttt{-{}-papersize=STRING}         & -&x&- & set PDF media size to STRING \\
\texttt{-{}-param-size=n}             & p&x&- & Set the the maximum number \\
                                      &  & &        & of simultaneous macro parameters. \\
\texttt{-{}-pool-free=n}              & p&x&- & Set the minimum pool space left after loading the format. \\
\texttt{-{}-pool-size=n}              & p&x&- & Set the maximum number of characters in strings, \dots \\
\texttt{-{}-quiet}                    & p&x&- & Suppress all output, except errors. \\
\texttt{-{}-record-package-usages=file} & p&x&- & Record all package usages and write them into \texttt{file}. \\
\texttt{-{}-recorder}                 & p&x&l       & Enable the file name recorder\footnote%
{The same as in \texlive. }. \\
\texttt{-{}-safer}                    & -&-&l & Disable easily exploitable Lua commands\footnote%
   {The same as for \texlive. }.   \\
\texttt{-{}-save-size=n}              & p&x&- & Set the the amount of space for saving values \\
                                      &  & &        & outside of current group. \\
\texttt{-{}-src-specials}             & p&x&- & Embed source file information in the DVI file\footnote%
{Similar as in \texlive. }. \\
\texttt{-{}-stack-size=n}             & p&x&- & Set the maximum number of simultaneous input sources. \\
\texttt{-{}-string-vacancies=n}       & p&x&- & Set the minimum number of characters \dots \\
\texttt{-{}-synctex=n}                & p&x&l       & Generate SyncTeX data for previewers\footnote%
{Explanation with more detail than for \texlive. } \\
\texttt{--tcx=tcxname}                & p&-&- & Use the tcxname translation table \dots \\
\texttt{-{}-time-statistics}          & p&x&- & Show processing time statistics. \\
\texttt{-{}-trace[=tracestreams]}     & p&x&- & Enable trace messages. \\
\texttt{-{}-trie-size=n}              & p&x&- & Set the amount of space for hyphenation patterns. \\
\texttt{-{}-undump=name}              & p&x&l       & Use name as the name of the format to be used, \dots \\
\texttt{-{}-utc}                        & -&-&l & Init time to UTC\footnote%
   {The same as for \texlive. }.  \\
\texttt{-{}-version}                  & p&x&l       & Show version information and exit\footnote%
{The same as for \texlive. }. \\
\end{longtable}
}

Strange, there are \texttt{-{}-enable-etex} and \texttt{-{}-enable-mltex} 
but no way to disable. 
Maybe disable is the default. 

\begin{verbatim}
  miktex-pdftex [option...] [[file] | [\command...]]
\end{verbatim}

% \begin{longtable}{|ll|}
%   \toprule
%   option & explanation \\
%   \midrule
%   \midrule
%   \endfirsthead%
%   \bottomrule
%   \caption{\label{tab:latexOptionsPdflatexMiktex} Options specific to \pdflatex{} }
%   \endlastfoot%
%   \end{longtable}




\begin{verbatim}
  miktex-luatex [option...] [[command...] | [file]]

The following options are ignored:

--8bit, --etex, --parse-first-line, --no-parse-first-line
These are always on.

--default-translate-file=tcxname, --translate-file=tcxname
These are always off.
\end{verbatim}

% \begin{longtable}{|ll|}
%   \toprule
%   option & explanation \\
%   \midrule
%   \midrule
%   \endfirsthead%
%   \bottomrule
%   \caption{\label{tab:latexOptionsLualatexMiktex} \miktex: Options specific to \lualatex{} }
%   \endlastfoot%
%   % \texttt{-{}-[no-]file-line-error-style} & aliases of --[no-]file-line-error \\
%   \midrule
%   \midrule
%   \end{longtable}


  
  
  

\begin{verbatim}
  miktex-xetex [option...] [[file] | [\command...]]
\end{verbatim}



% \begin{longtable}{|ll|}
%   \toprule
%   option & explanation \\
%   \midrule
%   \midrule
%   \endfirsthead%
%   \bottomrule
%   \caption{\label{tab:latexOptionsXelatexMiktex} \miktex: Options specific to \xelatex{} }
%   \endlastfoot%
%    \end{longtable}

%   Same options as for \texlive, except \texttt{-etex} which is specific to \texlive. 



\section{Treatment of metadata for the PDF format}\label{sec:metaPDF}

TBD: rework: required is a link to \texttt{headerSuppressMetaPDF.tex}. 
This is only possible after this is an injection. 
Also use references to~\cite{LuaTexRef} and to~\cite{PdfTexUsr}. 

Whereas \xelatex{} always produces a XDV file internally as an intermediate step, 
when creating a PDF file, with the option \texttt{-no-pdf} 
one can eliminate creation of the PDF file and writing of the intermediate XDV file instead. 
For conversion, of the XDV file to PDF, the option \texttt{-output-driver=CMD} 
is used which defaults to the command \texttt{xdvipdfmx}. 
Besides direct creation of a PDF file, 
we consider creation via XDV file using \texttt{xdvipdfmx}. 
The XDV format is an extension and in fact a variant of the DVI format. 

For the other compilers in contrast, the option \texttt{-output-format=dvi/pdf} 
determines the output format which is PDF by default 
and there is no intermediate format for PDF. 
When creating DVI files instead, these files can be converted into PDF 
by explicitly invoking something like 
\texttt{dvipdfmx}, \texttt{dvipdfmx} or \texttt{xdvipdfmx}. 
In my current distribution \texlive, 
the programs \texttt{dvipdfm}, \texttt{dvipdfmx} and \texttt{xdvipdfmx} 
are all binary identical. 

Nevertheless, they turn out to yield different results. 
One reason turning out later is, 
that the name with which the program is invoked 
goes into the result. 
It is likely that this is the only reason. 

As a consequence of the workflow of \xelatex, 
\cmd{ifpdf} provided by package \texttt{iftex} 
always enters the \cmd{else} branch for \xelatex. 

To display metadata, we use \texttt{exiftool} and \texttt{pdfinfo}. 


\subsection{Reproducibility}\label{subsec:reprod}

The first observation is, that invocation of \texttt{xelatex latexEngines} 
produces different PDF output for each run. 
Likewise, \texttt{xelatex -no-pdf latexEngines} produces different XDV output for each run. 
As turns out later, this is because the creation time goes into the result. 

Thus, it is plausible that, to obtain reproducibility, we invoke the compiler as 
%
\begin{verbatim}
  SOURCE_DATE_EPOCH=0 FORCE_SOURCE_DATE=1 xelatex         latexEngines
  SOURCE_DATE_EPOCH=0 FORCE_SOURCE_DATE=1 xelatex -no-pdf latexEngines
\end{verbatim}

The second result is, that creating the PDF file and the XDV file that way is reproducible. 

Now it is time to see differences directly and thus switch off compression 
which is done independent of the compiler by an according header 
%
\begin{verbatim}
  \DocumentMetadata{uncompress}
\end{verbatim}
%
described in~\cite{DocMetaDataSuppCode}. 
Seemingly, this writes additional info like metainfo date 
but also resurrects all other dates and also influences trailerid in a way, 
that the document is no longer reproducible, 
even when specifying \texttt{SOURCE\_DATE\_EPOCH=0 FORCE\_SOURCE\_DATE=1}. 

TBD: file a bug report. 
TBD: clarify whether this is true for other compilers also. 

Thus, we take refuge to switching off compression via 
%
\begin{verbatim}
  \special{dvipdfmx:config z 0}
\end{verbatim}
%
This is specific for \xelatex, but it keeps reproducibility. 

It turns out, that this compression setting does not refer to the XDV file, 
which seems always compressed, but solely to the PDF file. 
The PDF files differ mainly in the time stamp 
but also in some hashes which may depend on the time stamp. 

Now let us experiment with \texttt{xdvipdfmx}. 
Even if we start with a reproducible XDV file, 
the PDF file created by \texttt{xdvipdfmx} 
changes with each invocation. 
This changes when also \texttt{xdvipdfmx} is invoked with fixed time. 
%
\begin{verbatim}
  SOURCE_DATE_EPOCH=0 FORCE_SOURCE_DATE=1 xdvipdfmx latexEngines
\end{verbatim}

As mentioned above, in the distribution \texlive{} current at time of this writing, 
the programs \texttt{dvipdfm}, \texttt{dvipdfmx} and \texttt{xdvipdfmx} 
are all binary identical. 
Nevertheless, they seem to lead to different output. 
Possibly, the invocation name goes into the result. 
To find out, we do not allow compression. 
It turns out that the names go into the result as the producer. 

Using the package \texttt{hyperref}, 
one can overwrite a lot of metadata. 
Details are found in the manual~\cite{HyperTextP}, Section 5.10. 
In particular, the producer can be set \texttt{unknown}. 
As a result, the trailer identifier is the only remaining difference. 
Seemingly, the producer goes into this whether displayed or not. 
The trailer identifier cannot be overwritten by \texttt{hyperref}, 
but only in a way specific for \xelatex: 
%
\begin{verbatim}
  \special{pdf:trailerid [
    <00112233445566778899aabbccddeeff>
    <00112233445566778899aabbccddeeff>
  ]}  
\end{verbatim}
%
makes even the XDV to PDF converter transparent. 

In~\cite{HyperTextP}, Section 5.10, also the creator is found, 
which is \texttt{LaTeX with hyperref} independent of the \LaTeX{} compiler. 
This shall be overwritten if there are security concerns. 



As long as the tool chain and settings remain constant, 
invocation of latex compiler \xelatex and backend XDV to PDF converter 
specifying \texttt{SOURCE\_DATE\_EPOCH=0 FORCE\_SOURCE\_DATE=1} 
suffices to guarantee reproducibility. 
This setting refers to creation date \texttt{1970:01:01 01:00:00+01:00} 
and if the file exist, this is the modification date. 
From the point of view of reproducibility, 
there is ok, but it is not the truth. 
Thus, it makes sense to overwrite this with the string \texttt{unknown}. 
If the file is overwritten, the same considerations apply to the modification date. 
Both can be overwritten with package \texttt{hyperref}. 

One question remains: how does \texttt{hyperref} manipulate the metadata 
and in a second step, can we do this directly without using \texttt{hyperref}. 
\medskip


Now let us switch to the other two \LaTeX{} compilers. 
Both write the banner information indicating 
above all the type of compiler and the version. 
As checked by switching compression of, \xelatex{} does not write any banner information. 
Again, as long as the compiler does not change nor changes its version or its distribution, 
the banner does not corrupt reproducibility. 
On the other hand, removing it would stabilize and generalize reproducibility somewhat. 
Also, privacy or security is an argument in favor of 
The package \texttt{hyperref} offers no way to change the banner; 
this can be done only in a machine specific way. 
The details are described below. % TBD 
The same is true for the trailer identifier. 
The difference is that the trailer identifier 
must be explicitly overwritten to obtain reproducibility for some reason. 
Strictly speaking it need not be suppressed for reproducibility, 
but to make the result independent of the DVI to PDF converter. 

Creating DVI files with \texttt{SOURCE\_DATE\_EPOCH=0 FORCE\_SOURCE\_DATE=1} 
yields reproducible results. 
As expected, these settings are also necessary for translating DVI into PDF. 



\subsection{Security and Stability of Reproducibility}\label{subsec:securityRep}

Security is here privacy. 
Hiding information makes attacks more difficult. 
Stability of reproducibility consists in stability as regards new versions of the same tools 
in the tool chain and the aspect of change of a tool. 

From Section~\ref{subsec:reprod} come the recommendation 
to set the following pieces of information to unknown: 
%
\begin{description}
  \item[Creator] This is uniformly \texttt{LaTeX with hyperref} 
  as long as \texttt{hyperref} is loaded. 
  If not it is \TeX{} except for \xelatex which shows compiler, and creation date. 
  Thus, it is advisable in general for security but without \texttt{hyperref} 
  for sake of stability of reproducibility. 
  \item[Producer] This is \texttt{xdvipdfmx} with version for creating DVIs 
  and in general for \xelatex. 
  For creating PDF with \pdflatex{} or with \lualatex, 
  it is something like \texttt{pdfTeX-1.40.25} or \texttt{LuaTeX-1.17.0}. 
  This shall be hidden for sake of security and stability of reproducibility. 
  \item[CreationDate] This is wrong if using \texttt{SOURCE\_DATE\_EPOCH=0 FORCE\_SOURCE\_DATE=1} 
  and shall thus be hidden. 
  \item[ModDate] same as \texttt{CreationDate}. 
  \item[PTEX.Fullbanner] is not written by \xelatex, 
  but both for \lualatex and for \pdflatex. 
  It can be suppressed in a compiler specific way, 
  but not through \texttt{hyperref}. 
  The banner exposes tools, versions and distributions. 
  Thus, it shall not be exposed for sake of security and stability of reproducibility. 
  \item[trailer identifier]
  Suppressing this is necessary for reproducibility, 
  except for \xelatex. 
  For \xelatex, it is just independence of the XDV to PDF converter 
  and thus a matter of stability of reproducibility. 
  It has only a very weak aspect of security. 
  
  The downside is that, 
  even without setting \texttt{SOURCE\_DATE\_EPOCH=0 FORCE\_SOURCE\_DATE=1}, 
  created PDF files stop to be individual for each creation run 
  as is intended for PDF files. 
  We decided that the date offers enough individuality 
  to refrain from the trailer identifier. 
\end{description}


\subsection{Reproducibility revisited}\label{subsec:reprod2}

The next question is, 
whether the setting \texttt{SOURCE\_DATE\_EPOCH=0 FORCE\_SOURCE\_DATE=1} 
is really needed, if both \texttt{CreationDate} and \texttt{ModDate} are suppressed. 
If a document contains a date inserted via command \cmd{date}, 
then this is only reproducible 
with setting \texttt{SOURCE\_DATE\_EPOCH=0 FORCE\_SOURCE\_DATE=1}. 
Even without \cmd{date}, \xelatex seems to use hashes depending on time 
corrupting reproducibility. 
To be more precise, creation of XDV is reproducible, 
whereas conversion to PDF is not. 
So, for sake of uniformity and stability of reproducibility, 
these settings are heavily recommended, 
both for the \LaTeX{} compiler and for the converter DVI/XDV to PDF. 

If reproducibility is only required for tests, 
then the date can be given; it is just neglected for tests. 
For productive documents the date is important. 
If reproducibility is an issue for productive documents, the date cannot be given. 

\subsection{Security revisited}\label{subsec:security2}

Both \lualatex{} and \pdflatex{} write the filename in \texttt{PTEX.FileName}. 
This is a security issue, 
whereas the number of pages, \texttt{PTEX.PageNumber} is not. 
It is also useful. 

For the \texttt{trapped} setting, the author wonders for \pdflatex, 
how \texttt{hyperref} can switch this individually, whereas the compiler specific setting 
allows only setting to \texttt{unknown} 
in conjunction with other settings. 


\section{To be clarified}\label{sec:TBC}

Note that \xelatex{} works as the other engines for PDF, 
whereas it has XDV instead of DVI as alternative format. 
Thus, the format DVI is ignored. 
See the manual. 


\bibliographystyle{alpha}
\bibliography{../lit}{}% chktex 11 


\end{document}


